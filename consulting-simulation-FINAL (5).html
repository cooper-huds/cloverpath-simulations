<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Management Consulting Simulation - GreenLeaf Grocery Analysis - Cloverpath</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Global overflow protection */
        body, html {
            overflow-x: hidden;
            width: 100%;
        }

        /* Ensure all text respects boundaries */
        p, h1, h2, h3, h4, h5, h6, li, td, th, div, span {
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
        }

        :root {
            --primary-green: #2d8659;
            --light-green: #7cb342;
            --dark-green: #1b5e3a;
            --light-green-dark: #5a9c2e;
            --bg-light: #f5f9f7;
            --text-dark: #1a1a1a;
            --text-gray: #666;
            --border-color: #e0e0e0;
            --white: #ffffff;
            --yellow: #ffc107;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            overflow-x: hidden;
            width: 100%;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);
            color: var(--white);
            padding: 40px 20px;
            text-align: center;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .company-banner {
            background: linear-gradient(135deg, #5a9c2e 0%, #7cb342 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            word-wrap: break-word;
        }

        .company-banner h2 {
            font-size: 2rem;
            margin-bottom: 5px;
            line-height: 1.2;
        }

        .company-banner p {
            opacity: 0.9;
            line-height: 1.4;
        }

        .quick-facts {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .quick-facts h3 {
            color: var(--text-dark);
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .facts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .fact-item {
            padding: 15px;
            border-radius: 8px;
            background: var(--bg-light);
        }

        .fact-item.primary {
            background: linear-gradient(135deg, rgba(45, 134, 89, 0.1) 0%, rgba(45, 134, 89, 0.05) 100%);
            border-left: 4px solid var(--primary-green);
        }

        .fact-item.warning {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 193, 7, 0.05) 100%);
            border-left: 4px solid var(--yellow);
        }

        .fact-item.info {
            background: linear-gradient(135deg, rgba(124, 179, 66, 0.1) 0%, rgba(124, 179, 66, 0.05) 100%);
            border-left: 4px solid var(--light-green);
        }

        .fact-label {
            font-size: 0.9rem;
            color: var(--text-gray);
            margin-bottom: 5px;
        }

        .fact-value {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--text-dark);
        }

        .alert-banner {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 4px solid var(--yellow);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .alert-banner strong {
            color: var(--dark-green);
        }

        .progress-container {
            background: var(--white);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: var(--border-color);
            border-radius: 6px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-green) 0%, var(--light-green) 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--text-gray);
        }

        .section {
            display: none;
            background: var(--white);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow-x: hidden;
            width: 100%;
        }

        .section.active {
            display: block;
        }

        .section-header {
            margin-bottom: 30px;
        }

        .section-header h2 {
            color: var(--primary-green);
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .section-header p {
            color: var(--text-gray);
            font-size: 1.1rem;
        }

        .guide-box {
            background: linear-gradient(135deg, rgba(45, 134, 89, 0.05) 0%, rgba(124, 179, 66, 0.05) 100%);
            border: 2px solid var(--light-green);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            word-wrap: break-word;
            overflow-wrap: break-word;
            overflow: hidden;
        }

        .guide-box h3 {
            color: var(--primary-green);
            margin-bottom: 15px;
            word-wrap: break-word;
        }

        .guide-checklist {
            display: grid;
            gap: 10px;
        }

        .guide-item {
            padding: 10px 15px;
            background: white;
            border-radius: 6px;
            border-left: 3px solid var(--light-green);
            font-weight: 500;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .materials-box {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
            position: relative;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .materials-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
            gap: 10px;
            flex-wrap: wrap;
        }

        .materials-header h3 {
            color: var(--text-dark);
            font-size: 1.2rem;
            flex: 1;
            min-width: 200px;
        }

        .materials-toggle {
            background: var(--primary-green);
            color: white;
            padding: 8px 16px;
            border-radius: 5px;
            font-size: 0.85rem;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .materials-content {
            margin-top: 15px;
            display: none;
        }

        .materials-content.show {
            display: block;
        }

        .materials-content h4 {
            color: var(--primary-green);
            margin: 20px 0 10px 0;
            font-size: 1.2rem;
        }

        .materials-content p {
            margin-bottom: 15px;
            line-height: 1.8;
        }

        .materials-content strong {
            color: var(--dark-green);
        }

        .materials-content ul {
            margin-left: 20px;
        }

        .materials-content li {
            margin-bottom: 5px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            background: white;
        }

        .data-table th,
        .data-table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .data-table th {
            background: #5a9c2e;
            color: white;
            font-weight: 600;
        }

        .data-table tr:nth-child(even) {
            background: #f8fafc;
        }

        .highlight-box {
            background: #fef3c7;
            border-left: 4px solid var(--yellow);
            padding: 15px;
            margin: 15px 0;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .input-group {
            margin: 20px 0;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 5px;
            cursor: help;
        }

        .tooltip-icon {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: var(--primary-green);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 18px;
            font-size: 12px;
            font-weight: bold;
        }

        .tooltip-text {
            visibility: hidden;
            width: 250px;
            background-color: var(--text-dark);
            color: white;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            line-height: 1.4;
            font-weight: normal;
        }

        .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--text-dark) transparent transparent transparent;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .input-group input,
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--primary-green);
        }

        .input-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .input-hint {
            font-size: 0.85rem;
            color: var(--text-gray);
            margin-top: 5px;
            font-style: italic;
        }

        .example-box {
            background: var(--bg-light);
            border-radius: 8px;
            margin: 15px 0;
            overflow: hidden;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .example-header {
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s ease;
            word-wrap: break-word;
        }

        .example-header:hover {
            background: rgba(45, 134, 89, 0.05);
        }

        .example-header h4 {
            color: var(--primary-green);
            margin: 0;
            word-wrap: break-word;
        }
            font-size: 1rem;
        }

        .example-toggle {
            font-size: 0.85rem;
            color: var(--text-gray);
        }

        .example-content {
            padding: 0 15px 15px 15px;
            display: none;
        }

        .example-content.show {
            display: block;
        }

        .example-good {
            border-left: 4px solid var(--light-green);
        }

        .example-bad {
            border-left: 4px solid #f44336;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--primary-green);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--dark-green);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(45, 134, 89, 0.3);
        }

        .btn-secondary {
            background: var(--white);
            color: var(--primary-green);
            border: 2px solid var(--primary-green);
        }

        .btn-secondary:hover {
            background: var(--primary-green);
            color: var(--white);
        }

        .score-card {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--light-green) 100%);
            color: var(--white);
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin: 20px 0;
        }

        .score-number {
            font-size: 4rem;
            font-weight: bold;
            margin: 20px 0;
        }

        .score-breakdown {
            background: var(--white);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .score-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-dark);
        }

        .score-item:last-child {
            border-bottom: none;
        }

        .score-label {
            font-weight: 600;
        }

        .score-value {
            color: var(--primary-green);
            font-weight: bold;
        }

        .feedback-box {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid var(--primary-green);
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .feedback-box.warning {
            border-left-color: #ff9800;
            background: #fff3e0;
        }

        .feedback-box.error {
            border-left-color: #f44336;
            background: #ffebee;
        }

        .feedback-box.success {
            border-left-color: var(--light-green);
            background: #f1f8e9;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }

        .btn-export {
            background: var(--light-green);
            color: var(--white);
        }

        .btn-export:hover {
            background: var(--light-green-dark);
        }

        .framework-box {
            background: white;
            border: 2px solid var(--light-green);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            word-wrap: break-word;
            overflow-wrap: break-word;
            overflow: hidden;
        }

        .framework-box h4 {
            color: var(--light-green-dark);
            margin-bottom: 10px;
            word-wrap: break-word;
        }

        .framework-box p,
        .framework-box ul,
        .framework-box li {
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .calc-box {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            word-wrap: break-word;
            overflow-wrap: break-word;
            overflow-x: auto;
        }

        .calc-box strong {
            color: var(--primary-green);
        }

        @media (max-width: 768px) {
            body {
                font-size: 14px;
            }

            .container {
                padding: 10px;
            }

            .header {
                padding: 20px 15px;
                margin-bottom: 20px;
            }

            .header h1 {
                font-size: 1.5rem;
                margin-bottom: 8px;
            }

            .header p {
                font-size: 0.9rem;
            }

            .company-banner {
                padding: 15px;
            }

            .company-banner h2 {
                font-size: 1.3rem;
                line-height: 1.3;
                word-break: break-word;
            }

            .company-banner p {
                font-size: 0.85rem;
                line-height: 1.4;
            }

            .progress-container,
            .section,
            .quick-facts,
            .guide-box,
            .framework-box {
                padding: 15px;
                margin-bottom: 15px;
            }

            .materials-box {
                padding: 15px;
                margin-bottom: 15px;
            }

            .section-header {
                padding-left: 15px;
                margin-bottom: 20px;
            }

            .section-header h2 {
                font-size: 1.4rem;
            }

            .section-header p {
                font-size: 0.9rem;
            }

            .facts-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .fact-item {
                padding: 12px;
            }

            .fact-label {
                font-size: 0.7rem;
            }

            .fact-value {
                font-size: 1.1rem;
            }

            .guide-checklist {
                grid-template-columns: 1fr;
            }

            .materials-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .materials-header h3 {
                font-size: 1.1rem;
                min-width: 0;
                flex: none;
                width: 100%;
                word-break: break-word;
                line-height: 1.4;
            }

            .materials-toggle {
                padding: 10px 16px;
                font-size: 0.85rem;
                align-self: flex-start;
            }

            .materials-content {
                font-size: 0.9rem;
                padding: 0;
            }

            .materials-content h4 {
                font-size: 1.05rem;
                margin: 15px 0 8px 0;
            }

            .materials-content p {
                margin-bottom: 12px;
                line-height: 1.6;
            }

            .materials-content ul {
                margin-left: 15px;
            }

            .materials-content li {
                margin-bottom: 8px;
                line-height: 1.5;
            }

            .data-table {
                font-size: 0.7rem;
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .data-table th,
            .data-table td {
                padding: 8px 4px;
                font-size: 0.7rem;
            }

            .data-table th {
                white-space: nowrap;
            }

            .input-group {
                margin: 15px 0;
            }

            .input-group label {
                font-size: 0.95rem;
            }

            .input-group input,
            .input-group textarea,
            .input-group select {
                padding: 10px;
                font-size: 16px; /* Prevents zoom on iOS */
            }

            .input-group textarea {
                min-height: 100px;
            }

            .checkbox-item {
                padding: 12px 8px;
                align-items: flex-start;
            }

            .checkbox-item input[type="checkbox"] {
                margin-top: 2px;
                flex-shrink: 0;
            }

            .checkbox-item label {
                font-size: 0.9rem;
            }

            .button-group {
                flex-direction: column;
                gap: 10px;
            }

            .btn {
                width: 100%;
                padding: 14px 20px;
                font-size: 1rem;
            }

            .tooltip-wrapper:hover .tooltip-text {
                display: none; /* Disable tooltips on mobile */
            }

            .tooltip-icon {
                display: none; /* Hide tooltip icons on mobile */
            }

            .calc-box {
                font-size: 0.75rem;
                padding: 12px;
                word-break: break-word;
            }

            .example-box {
                padding: 15px;
                font-size: 0.9rem;
            }

            .example-good,
            .example-bad {
                padding: 10px;
                font-size: 0.85rem;
                word-break: break-word;
            }

            .highlight-box,
            .feedback-box,
            .alert-banner {
                padding: 12px 15px;
                font-size: 0.9rem;
            }

            .score-card {
                padding: 20px 15px;
            }

            .score-number {
                font-size: 3rem;
                margin: 15px 0;
            }

            .score-breakdown {
                padding: 15px;
            }

            .score-item {
                padding: 10px 0;
                font-size: 0.9rem;
            }

            .export-buttons {
                flex-direction: column;
            }

            .framework-box h4,
            .guide-box h3,
            .materials-header h3 {
                font-size: 1.1rem;
            }

            /* Make tables scroll horizontally on mobile */
            .materials-content table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
                -webkit-overflow-scrolling: touch;
            }

            /* Force examples to not break layout */
            .example-header,
            .example-content {
                word-break: break-word;
            }
        }

        /* Extra small devices */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.3rem;
            }

            .company-banner {
                padding: 12px;
            }

            .company-banner h2 {
                font-size: 1.1rem;
            }

            .company-banner p {
                font-size: 0.8rem;
            }

            .section-header h2 {
                font-size: 1.2rem;
            }

            .score-number {
                font-size: 2.5rem;
            }

            .data-table th,
            .data-table td {
                padding: 6px 3px;
                font-size: 0.65rem;
            }

            .materials-header h3 {
                font-size: 1rem;
                line-height: 1.3;
            }

            .materials-toggle {
                font-size: 0.8rem;
                padding: 8px 14px;
            }

            .materials-content h4 {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Management Consulting Simulation</h1>
            <p>Apply strategic frameworks to diagnose problems and develop recommendations</p>
        </div>

        <div class="progress-container">
            <h3>Your Progress</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text">
                <span id="progressLabel">Introduction</span>
                <span id="progressPercent">0% Complete</span>
            </div>
        </div>

        <!-- Section 0: Introduction & Materials -->
        <div class="section active" id="section0">
            <div class="company-banner">
                <h2>GreenLeaf Grocery</h2>
                <p>Regional Grocery Chain - Revenue Decline Crisis</p>
            </div>

            <div class="quick-facts">
                <h3>Client Overview</h3>
                <div class="facts-grid">
                    <div class="fact-item warning">
                        <div class="fact-label">Same-Store Sales Change</div>
                        <div class="fact-value">-8.3% YoY</div>
                    </div>
                    <div class="fact-item primary">
                        <div class="fact-label">Annual Revenue</div>
                        <div class="fact-value">$623M (from $680M)</div>
                    </div>
                    <div class="fact-item warning">
                        <div class="fact-label">Gross Margin</div>
                        <div class="fact-value">19% (from 24%)</div>
                    </div>
                    <div class="fact-item info">
                        <div class="fact-label">Store Count</div>
                        <div class="fact-value">42 locations</div>
                    </div>
                </div>
            </div>

            <div class="alert-banner">
                <strong>CLIENT REQUEST:</strong> You are a Consultant at Bain & Company working on a turnaround engagement for GreenLeaf Grocery, a regional grocery chain facing severe competitive pressure from online delivery services and discount competitors. Same-store sales have declined 8.3% year-over-year, margins are compressing, and the CEO needs a strategic recommendation within 3 weeks. Your task is to apply consulting frameworks (MECE, Porter's Five Forces, SWOT) to diagnose root causes, evaluate strategic options, and develop an actionable implementation roadmap.
            </div>

            <div class="section-header">
                <h2>Case Materials & Client Data</h2>
                <p>Review all materials before beginning your analysis</p>
            </div>

            <div class="feedback-box success">
                <h3 style="margin-bottom: 10px;">Your Role</h3>
                <p>You are a <strong>Consultant</strong> on the GreenLeaf Grocery engagement team. The Partner has asked you to lead the diagnostic phase, applying structured problem-solving frameworks to identify the root causes of revenue decline and develop 2-3 strategic options with financial impact analysis.</p>
                <p style="margin-top: 10px;"><strong>Your Mission:</strong> Decompose the revenue problem using MECE principles, apply Porter's Five Forces to assess competitive dynamics, complete a rigorous SWOT analysis, evaluate strategic alternatives, and build an 18-month implementation roadmap with KPIs.</p>
            </div>

            <div class="guide-box">
                <h3>Framework Toolkit for This Case:</h3>
                <div class="guide-checklist">
                    <div class="guide-item">MECE Decomposition: Break down revenue decline into mutually exclusive, collectively exhaustive drivers</div>
                    <div class="guide-item">Porter's Five Forces: Assess competitive intensity and structural attractiveness of grocery retail</div>
                    <div class="guide-item">SWOT Analysis: Map internal strengths/weaknesses against external opportunities/threats</div>
                    <div class="guide-item">Strategic Options: Develop 2-3 distinct strategies with ROI quantification</div>
                    <div class="guide-item">Implementation: Phase initiatives, define KPIs, identify risks</div>
                </div>
            </div>

            <div class="materials-box" id="mat-client">
                <div class="materials-header" onclick="toggleMaterials('clientData')">
                    <h3>GreenLeaf Grocery Case Materials</h3>
                    <span class="materials-toggle">Click to View</span>
                </div>
                <div class="materials-content" id="clientData">
                    <h4>Company Background</h4>
                    <p><strong>GreenLeaf Grocery</strong> is a regional grocery chain operating 42 stores across the Pacific Northwest (Oregon and Washington). Founded in 1987 by the Morrison family, GreenLeaf built its reputation on fresh produce, quality meats, and personalized customer service. The chain grew steadily through the 2000s, reaching $680M in annual revenue by 2022.</p>

                    <p><strong>Store Footprint:</strong></p>
                    <ul>
                        <li>42 stores (avg 32,000 sq ft per store)</li>
                        <li>Geographic concentration: Portland metro (18 stores), Seattle metro (12 stores), secondary markets (12 stores)</li>
                        <li>Store formats: Traditional full-service grocery, no discount or express formats</li>
                        <li>Real estate: 28 owned locations, 14 leased (avg lease term remaining: 7 years)</li>
                    </ul>

                    <p><strong>Historical Performance:</strong></p>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th>2020</th>
                                <th>2021</th>
                                <th>2022</th>
                                <th>2023 (LTM)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Revenue</td>
                                <td>$612M</td>
                                <td>$695M</td>
                                <td>$680M</td>
                                <td>$623M</td>
                            </tr>
                            <tr>
                                <td>Same-Store Sales Growth</td>
                                <td>+2.1%</td>
                                <td>+13.6%</td>
                                <td>-2.2%</td>
                                <td>-8.3%</td>
                            </tr>
                            <tr>
                                <td>Gross Margin</td>
                                <td>23.5%</td>
                                <td>24.8%</td>
                                <td>24.0%</td>
                                <td>19.1%</td>
                            </tr>
                            <tr>
                                <td>EBITDA Margin</td>
                                <td>5.2%</td>
                                <td>6.8%</td>
                                <td>5.9%</td>
                                <td>2.3%</td>
                            </tr>
                            <tr>
                                <td>Avg Transaction Value</td>
                                <td>$42</td>
                                <td>$48</td>
                                <td>$47</td>
                                <td>$45</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4>Problem Statement - Revenue Decline Decomposition</h4>
                    <p>GreenLeaf's revenue decline from $680M (2022) to $623M (2023 LTM) represents a -8.3% decrease. Using MECE decomposition, the revenue decline breaks down as follows:</p>

                    <div class="calc-box">
                        <strong>Revenue = Traffic × Conversion Rate × Average Basket Size</strong><br><br>
                        <strong>2022:</strong> $680M = 14.2M visitors × 68% conversion × $70 basket<br>
                        <strong>2023:</strong> $623M = 12.5M visitors × 73% conversion × $67 basket<br><br>
                        <strong>Traffic Impact:</strong> -12.0% (14.2M → 12.5M visitors)<br>
                        <strong>Conversion Impact:</strong> +7.4% (68% → 73%)<br>
                        <strong>Basket Size Impact:</strong> -4.3% ($70 → $67)
                    </div>

                    <p><strong>Key Insight:</strong> The primary driver of revenue decline is traffic (-12.0%), partially offset by improved conversion. Traffic decline indicates customers are shopping elsewhere or reducing shopping frequency, not that GreenLeaf is failing to convert visitors into buyers.</p>

                    <h4>Customer & Market Research Data</h4>

                    <p><strong>Customer Survey Results (n=1,200 former/current GreenLeaf customers):</strong></p>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Why Reduced Shopping Frequency?</th>
                                <th>% Respondents</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Switched to online grocery delivery</td>
                                <td>45%</td>
                            </tr>
                            <tr>
                                <td>Shopping at lower-price competitors</td>
                                <td>32%</td>
                            </tr>
                            <tr>
                                <td>Prefer specialty stores (Whole Foods, Trader Joe's)</td>
                                <td>18%</td>
                            </tr>
                            <tr>
                                <td>Other (moved, dietary changes, etc.)</td>
                                <td>5%</td>
                            </tr>
                        </tbody>
                    </table>

                    <p><strong>Online Grocery Adoption:</strong></p>
                    <ul>
                        <li>2019: 12% of GreenLeaf customers used online grocery delivery monthly</li>
                        <li>2023: 38% of customers use online grocery delivery at least monthly</li>
                        <li>GreenLeaf does NOT offer online ordering or delivery (only in-store shopping)</li>
                        <li>Market research: 62% of surveyed customers would use GreenLeaf delivery if available</li>
                    </ul>

                    <p><strong>Price Sensitivity Data:</strong></p>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Retailer</th>
                                <th>Basket Price Index (GreenLeaf = 100)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>GreenLeaf Grocery</td>
                                <td>100</td>
                            </tr>
                            <tr>
                                <td>Walmart Supercenter</td>
                                <td>82 (18% cheaper)</td>
                            </tr>
                            <tr>
                                <td>Amazon Fresh</td>
                                <td>88 (12% cheaper)</td>
                            </tr>
                            <tr>
                                <td>Costco</td>
                                <td>76 (24% cheaper, bulk)</td>
                            </tr>
                            <tr>
                                <td>Whole Foods</td>
                                <td>118 (18% more expensive)</td>
                            </tr>
                            <tr>
                                <td>Trader Joe's</td>
                                <td>92 (8% cheaper)</td>
                            </tr>
                        </tbody>
                    </table>

                    <h4>Porter's Five Forces Analysis - Grocery Retail Industry</h4>

                    <p><strong>1. Threat of New Entrants: MEDIUM</strong></p>
                    <ul>
                        <li>Capital requirements moderate ($15-25M for new store buildout)</li>
                        <li>Real estate increasingly scarce in prime locations</li>
                        <li>Economies of scale important for supplier negotiations</li>
                        <li>However: Online-first models (Amazon Fresh, Instacart) bypass traditional barriers</li>
                    </ul>

                    <p><strong>2. Bargaining Power of Suppliers: LOW-MEDIUM</strong></p>
                    <ul>
                        <li>Large number of food suppliers creates competition</li>
                        <li>Major CPG brands (Coca-Cola, Kraft, etc.) have significant power</li>
                        <li>GreenLeaf's regional scale limits negotiating leverage vs. national chains</li>
                        <li>Fresh produce suppliers more fragmented (lower power)</li>
                    </ul>

                    <p><strong>3. Bargaining Power of Buyers: MEDIUM-HIGH</strong></p>
                    <ul>
                        <li>Customers highly price-sensitive (32% cite lower prices as reason for switching)</li>
                        <li>Low switching costs (customers easily shop multiple stores)</li>
                        <li>Transparency via apps/websites enables price comparison</li>
                        <li>However: Some customer loyalty to GreenLeaf's service quality and fresh produce</li>
                    </ul>

                    <p><strong>4. Threat of Substitutes: HIGH</strong></p>
                    <ul>
                        <li>Online grocery delivery rapidly growing (28% CAGR 2020-2023)</li>
                        <li>Meal kit services (HelloFresh, Blue Apron) address convenience need</li>
                        <li>Restaurant delivery apps (DoorDash, Uber Eats) substitute for some grocery trips</li>
                        <li>Discount clubs (Costco) bundle grocery shopping with membership value</li>
                    </ul>

                    <p><strong>5. Competitive Rivalry: VERY HIGH</strong></p>
                    <ul>
                        <li>Fragmented market with multiple formats (traditional, discount, online, specialty)</li>
                        <li>Major national players expanding: Walmart, Amazon, Kroger</li>
                        <li>Regional players fighting for share: Fred Meyer, QFC, Safeway</li>
                        <li>Low industry growth (2-3% annually) intensifies share battles</li>
                        <li>High fixed costs drive need for volume and utilization</li>
                    </ul>

                    <div class="highlight-box">
                        <strong>Porter's Five Forces Conclusion:</strong> Grocery retail is a structurally challenging industry with high competitive intensity, increasing threat from online substitutes, and moderate-to-high buyer power. GreenLeaf's regional scale puts it at a disadvantage against national players with superior purchasing power and technology investments.
                    </div>

                    <h4>SWOT Analysis Framework - GreenLeaf Grocery</h4>

                    <p><strong>STRENGTHS:</strong></p>
                    <ul>
                        <li><strong>Fresh Produce Reputation:</strong> Customer surveys rank GreenLeaf #1 in produce quality among regional competitors (87% satisfaction vs. 72% for Safeway)</li>
                        <li><strong>Store Locations:</strong> 28 owned properties provide long-term real estate stability and lower occupancy costs vs. leased competitors</li>
                        <li><strong>Local Brand Recognition:</strong> 78% unaided brand awareness in Portland/Seattle metro areas</li>
                        <li><strong>Experienced Workforce:</strong> Average employee tenure 6.2 years (vs. 2.8 years industry average); lower turnover reduces training costs</li>
                        <li><strong>Operational Efficiency:</strong> Labor productivity of $185K revenue per FTE vs. $172K industry median</li>
                    </ul>

                    <p><strong>WEAKNESSES:</strong></p>
                    <ul>
                        <li><strong>No E-Commerce Platform:</strong> Zero online ordering/delivery capability while 38% of target customers now shop online monthly</li>
                        <li><strong>Limited Scale:</strong> $623M revenue vs. $150B+ for Walmart, limiting supplier negotiating power and technology investment capacity</li>
                        <li><strong>Aging Store Format:</strong> Average store age 18 years; customer experience rated 6.2/10 vs. 7.8/10 for Whole Foods</li>
                        <li><strong>Premium Pricing:</strong> 12-18% price premium vs. Walmart/Amazon Fresh erodes value proposition</li>
                        <li><strong>Technology Deficit:</strong> Legacy POS system, no mobile app, limited CRM/loyalty program sophistication</li>
                        <li><strong>Geographic Concentration:</strong> 71% of stores in just 2 metro areas creates vulnerability to regional economic shocks</li>
                    </ul>

                    <p><strong>OPPORTUNITIES:</strong></p>
                    <ul>
                        <li><strong>Omnichannel Expansion:</strong> 62% of surveyed customers would use GreenLeaf delivery; online grocery growing at 28% CAGR</li>
                        <li><strong>Local/Organic Positioning:</strong> Consumer preference for locally-sourced food growing 15% annually; GreenLeaf's Pacific NW supplier relationships enable differentiation</li>
                        <li><strong>Prepared Foods/Deli:</strong> Ready-to-eat meals growing at 12% annually as consumers seek convenience; GreenLeaf's current deli sales represent only 8% of revenue vs. 14% industry average</li>
                        <li><strong>Private Label Expansion:</strong> GreenLeaf private label is only 12% of sales vs. 25-30% for leading chains; private label offers 25-30% higher margins</li>
                        <li><strong>Loyalty Program Enhancement:</strong> Current program is basic; personalized offers could drive 8-12% incremental spending per active member</li>
                    </ul>

                    <p><strong>THREATS:</strong></p>
                    <ul>
                        <li><strong>Amazon/Walmart Expansion:</strong> Amazon Fresh opened 4 stores in Seattle area in past 18 months; Walmart expanding grocery pickup/delivery aggressively</li>
                        <li><strong>Continued Margin Pressure:</strong> Supplier cost inflation 6-8% annually while competitive pricing limits pass-through to customers</li>
                        <li><strong>Labor Cost Inflation:</strong> Washington minimum wage increasing to $16.28/hour (vs. $13.50 currently); labor represents 38% of OpEx</li>
                        <li><strong>Real Estate Lease Renewals:</strong> 14 leased locations face renewal in next 5 years; landlords seeking 15-25% rent increases</li>
                        <li><strong>Consumer Behavior Shift:</strong> Younger demographics (18-35) show 2.3x higher preference for online grocery vs. 55+ age group; demographic headwind</li>
                    </ul>

                    <h4>Strategic Options - Analysis & Evaluation</h4>

                    <p><strong>OPTION 1: Omnichannel Integration (Delivery + Pickup)</strong></p>
                    <p>Build e-commerce platform with same-day delivery and curbside pickup. Partner with Instacart for logistics infrastructure, develop proprietary mobile app, and upgrade store infrastructure for efficient order fulfillment.</p>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Investment/Cost</th>
                                <th>Year 1</th>
                                <th>Years 2-3 (Annual)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>E-commerce platform development</td>
                                <td>$4.2M</td>
                                <td>$800K (maintenance)</td>
                            </tr>
                            <tr>
                                <td>Mobile app development</td>
                                <td>$1.8M</td>
                                <td>$400K (updates)</td>
                            </tr>
                            <tr>
                                <td>Store pickup infrastructure (all 42 stores)</td>
                                <td>$3.6M</td>
                                <td>$200K</td>
                            </tr>
                            <tr>
                                <td>Instacart partnership fees</td>
                                <td>$500K</td>
                                <td>3.5% of online GMV</td>
                            </tr>
                            <tr>
                                <td>Marketing & customer acquisition</td>
                                <td>$2.5M</td>
                                <td>$1.8M</td>
                            </tr>
                            <tr>
                                <td>Incremental labor (order fulfillment)</td>
                                <td>$1.2M</td>
                                <td>$2.8M</td>
                            </tr>
                            <tr>
                                <td><strong>Total 3-Year Investment</strong></td>
                                <td colspan="2"><strong>$24.1M</strong></td>
                            </tr>
                        </tbody>
                    </table>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Expected Benefits</th>
                                <th>Year 1</th>
                                <th>Year 2</th>
                                <th>Year 3</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Online revenue (% of total)</td>
                                <td>8%</td>
                                <td>18%</td>
                                <td>25%</td>
                            </tr>
                            <tr>
                                <td>Total revenue</td>
                                <td>$673M</td>
                                <td>$736M</td>
                                <td>$779M</td>
                            </tr>
                            <tr>
                                <td>Incremental gross profit</td>
                                <td>$10.5M</td>
                                <td>$23.8M</td>
                                <td>$32.9M</td>
                            </tr>
                            <tr>
                                <td>Customer retention improvement</td>
                                <td>+3%</td>
                                <td>+7%</td>
                                <td>+10%</td>
                            </tr>
                        </tbody>
                    </table>
                    <p><strong>3-Year NPV (12% discount): $38.2M | IRR: 42%</strong></p>

                    <p><strong>OPTION 2: Premium Local/Organic Repositioning</strong></p>
                    <p>Double down on GreenLeaf's fresh produce strength by repositioning as the Pacific Northwest's premier local/organic grocer. Expand partnerships with local farms, increase organic SKU count from 1,200 to 3,500, renovate stores with farmer's market aesthetic, and accept 15% higher cost structure offset by premium pricing.</p>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Investment/Cost</th>
                                <th>Year 1</th>
                                <th>Years 2-3 (Annual)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Store renovations (15 stores/year)</td>
                                <td>$18M</td>
                                <td>$18M</td>
                            </tr>
                            <tr>
                                <td>Expanded organic/local SKUs (supplier setup)</td>
                                <td>$2.8M</td>
                                <td>$600K</td>
                            </tr>
                            <tr>
                                <td>Staff training & certification</td>
                                <td>$1.2M</td>
                                <td>$400K</td>
                            </tr>
                            <tr>
                                <td>Rebranding & marketing campaign</td>
                                <td>$5.5M</td>
                                <td>$3.2M</td>
                            </tr>
                            <tr>
                                <td>Premium product COGS increase</td>
                                <td>$8.5M</td>
                                <td>$11.2M</td>
                            </tr>
                            <tr>
                                <td><strong>Total 3-Year Investment</strong></td>
                                <td colspan="2"><strong>$87.6M</strong></td>
                            </tr>
                        </tbody>
                    </table>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Expected Benefits</th>
                                <th>Year 1</th>
                                <th>Year 2</th>
                                <th>Year 3</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Avg basket size increase</td>
                                <td>+4%</td>
                                <td>+9%</td>
                                <td>+12%</td>
                            </tr>
                            <tr>
                                <td>Traffic change (win back premium segment)</td>
                                <td>-2%</td>
                                <td>+3%</td>
                                <td>+6%</td>
                            </tr>
                            <tr>
                                <td>Total revenue</td>
                                <td>$637M</td>
                                <td>$701M</td>
                                <td>$739M</td>
                            </tr>
                            <tr>
                                <td>Gross margin</td>
                                <td>20.8%</td>
                                <td>23.5%</td>
                                <td>25.1%</td>
                            </tr>
                        </tbody>
                    </table>
                    <p><strong>3-Year NPV (12% discount): $21.5M | IRR: 18%</strong></p>

                    <p><strong>OPTION 3: Discount Fighter Brand</strong></p>
                    <p>Launch "ValueMart by GreenLeaf" discount format in 8 locations, targeting price-sensitive customers lost to Walmart/Amazon. Limited SKU count (3,000 vs. 18,000 in traditional stores), no-frills store design, focus on private label and high-velocity items. Separate brand to protect premium GreenLeaf positioning.</p>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Investment/Cost</th>
                                <th>Year 1</th>
                                <th>Years 2-3 (Annual)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Convert 8 underperforming stores</td>
                                <td>$12.5M</td>
                                <td>$0</td>
                            </tr>
                            <tr>
                                <td>Private label development</td>
                                <td>$3.2M</td>
                                <td>$800K</td>
                            </tr>
                            <tr>
                                <td>Separate brand identity & marketing</td>
                                <td>$4.8M</td>
                                <td>$2.5M</td>
                            </tr>
                            <tr>
                                <td>Supplier renegotiation (volume discounts)</td>
                                <td>$600K</td>
                                <td>$200K</td>
                            </tr>
                            <tr>
                                <td><strong>Total 3-Year Investment</strong></td>
                                <td colspan="2"><strong>$25.1M</strong></td>
                            </tr>
                        </tbody>
                    </table>

                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Expected Benefits</th>
                                <th>Year 1</th>
                                <th>Year 2</th>
                                <th>Year 3</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ValueMart revenue contribution</td>
                                <td>$48M</td>
                                <td>$82M</td>
                                <td>$95M</td>
                            </tr>
                            <tr>
                                <td>Cannibalization of GreenLeaf stores</td>
                                <td>-$12M</td>
                                <td>-$18M</td>
                                <td>-$20M</td>
                            </tr>
                            <tr>
                                <td>Net total revenue</td>
                                <td>$659M</td>
                                <td>$687M</td>
                                <td>$698M</td>
                            </tr>
                            <tr>
                                <td>Blended gross margin</td>
                                <td>18.2%</td>
                                <td>18.9%</td>
                                <td>19.3%</td>
                            </tr>
                        </tbody>
                    </table>
                    <p><strong>3-Year NPV (12% discount): $8.7M | IRR: 9%</strong></p>

                    <h4>Recommended Strategy: Omnichannel Integration (Option 1)</h4>

                    <div class="highlight-box">
                        <strong>Recommendation Rationale:</strong> Option 1 (Omnichannel) delivers the highest NPV ($38.2M) and IRR (42%) while directly addressing the primary driver of revenue decline—45% of lost customers cited switching to online delivery. This strategy leverages GreenLeaf's existing strengths (fresh produce, local brand) while closing the critical capability gap. The moderate investment ($24.1M over 3 years) is achievable and creates a sustainable competitive moat through customer data and convenience. Option 2 (Premium) has merit but requires 3.6x more capital and targets a smaller addressable market. Option 3 (Discount) cannibalizes the core brand and offers the lowest returns.
                    </div>

                    <h4>Implementation Roadmap - 18 Month Plan</h4>

                    <p><strong>Phase 1: Foundation (Months 1-4)</strong></p>
                    <ul>
                        <li>Select and contract with e-commerce platform vendor (Shopify, custom build decision)</li>
                        <li>Sign Instacart partnership agreement for delivery logistics</li>
                        <li>Conduct customer research to prioritize feature set for mobile app</li>
                        <li>Pilot curbside pickup in 5 stores (highest-traffic locations)</li>
                        <li>Build internal project team (hire VP of Digital, 3 product managers)</li>
                        <li><strong>Expected Outcome:</strong> Pilot stores launch pickup, achieving 150 orders/week/store; validate customer demand and operational model</li>
                    </ul>

                    <p><strong>Phase 2: Market Launch (Months 5-9)</strong></p>
                    <ul>
                        <li>Roll out curbside pickup to all 42 stores</li>
                        <li>Launch mobile app (iOS, Android) with online ordering</li>
                        <li>Begin Instacart-powered delivery in Portland metro (18 stores)</li>
                        <li>Execute $2.5M marketing campaign targeting lapsed customers</li>
                        <li>Train 120 store associates on order fulfillment processes</li>
                        <li><strong>Expected Outcome:</strong> Achieve 8% of sales through digital channels in Portland; customer satisfaction score 7.8/10 for pickup/delivery</li>
                    </ul>

                    <p><strong>Phase 3: Scale & Optimize (Months 10-18)</strong></p>
                    <ul>
                        <li>Expand delivery to Seattle metro and secondary markets</li>
                        <li>Launch loyalty program integration (digital offers, personalized recommendations)</li>
                        <li>Optimize fulfillment operations (reduce order prep time from 28 min → 18 min)</li>
                        <li>Introduce subscription model ($9.99/month for free delivery)</li>
                        <li>Measure and improve unit economics (target $12 profit per online order)</li>
                        <li><strong>Expected Outcome:</strong> 18% of total sales digital by Month 18; 28,000 active subscription members; positive contribution margin on online channel</li>
                    </ul>

                    <h4>Key Performance Indicators (KPIs)</h4>

                    <p><strong>Leading Indicators (Track Weekly/Monthly):</strong></p>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>KPI</th>
                                <th>Month 4 Target</th>
                                <th>Month 9 Target</th>
                                <th>Month 18 Target</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>App Downloads</td>
                                <td>15,000</td>
                                <td>85,000</td>
                                <td>180,000</td>
                            </tr>
                            <tr>
                                <td>Weekly Active Users</td>
                                <td>4,200</td>
                                <td>28,000</td>
                                <td>62,000</td>
                            </tr>
                            <tr>
                                <td>Orders per Week</td>
                                <td>750</td>
                                <td>9,500</td>
                                <td>24,000</td>
                            </tr>
                            <tr>
                                <td>Customer Acquisition Cost</td>
                                <td>$42</td>
                                <td>$28</td>
                                <td>$18</td>
                            </tr>
                            <tr>
                                <td>Repeat Order Rate (30 days)</td>
                                <td>35%</td>
                                <td>52%</td>
                                <td>68%</td>
                            </tr>
                        </tbody>
                    </table>

                    <p><strong>Lagging Indicators (Track Monthly/Quarterly):</strong></p>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>KPI</th>
                                <th>Baseline (Current)</th>
                                <th>Month 9 Target</th>
                                <th>Month 18 Target</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Total Revenue</td>
                                <td>$623M</td>
                                <td>$658M</td>
                                <td>$736M</td>
                            </tr>
                            <tr>
                                <td>Same-Store Sales Growth</td>
                                <td>-8.3%</td>
                                <td>+2.1%</td>
                                <td>+8.5%</td>
                            </tr>
                            <tr>
                                <td>Digital % of Sales</td>
                                <td>0%</td>
                                <td>8%</td>
                                <td>18%</td>
                            </tr>
                            <tr>
                                <td>Customer Retention Rate</td>
                                <td>68%</td>
                                <td>73%</td>
                                <td>78%</td>
                            </tr>
                            <tr>
                                <td>Gross Margin</td>
                                <td>19.1%</td>
                                <td>20.8%</td>
                                <td>22.3%</td>
                            </tr>
                        </tbody>
                    </table>

                    <p><strong>Risk Flags (Monitor Closely):</strong></p>
                    <ul>
                        <li><strong>Technology Execution Risk:</strong> Platform launch delays or poor user experience → Mitigation: Select proven vendor, conduct extensive UAT, maintain backup vendors</li>
                        <li><strong>Unit Economics:</strong> Online orders unprofitable due to fulfillment costs → Mitigation: Target $12 contribution margin per order; implement minimum order values; optimize pick efficiency</li>
                        <li><strong>Cannibalization:</strong> Online sales cannibalize profitable in-store traffic → Mitigation: Track total customer value (online + offline); focus on incremental customers and basket size growth</li>
                        <li><strong>Competitive Response:</strong> Walmart/Amazon respond with aggressive pricing → Mitigation: Differentiate on quality, local products, and service; avoid pure price competition</li>
                        <li><strong>Operational Complexity:</strong> Store associates struggle with dual fulfillment model → Mitigation: Dedicated fulfillment teams in high-volume stores; comprehensive training program</li>
                    </ul>

                    <h4>Financial Summary - 3-Year Projection</h4>
                    <div class="calc-box">
                        <strong>Baseline Scenario (Do Nothing):</strong><br>
                        Revenue continues declining at -6% annually → $552M by Year 3<br>
                        Gross margin compresses to 17.5%<br>
                        EBITDA turns negative by Year 2<br><br>
                        
                        <strong>Omnichannel Strategy Scenario:</strong><br>
                        Year 1: $673M revenue, 20.5% gross margin, 3.8% EBITDA margin<br>
                        Year 2: $736M revenue, 21.8% gross margin, 5.2% EBITDA margin<br>
                        Year 3: $779M revenue, 22.3% gross margin, 6.1% EBITDA margin<br><br>
                        
                        <strong>Total Value Creation vs. Baseline:</strong> $127M cumulative EBITDA improvement over 3 years
                    </div>

                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="nextSection()">Begin Case Analysis →</button>
            </div>
        </div>

        <!-- Section 1: Problem Definition & MECE Decomposition -->
        <div class="section" id="section1">
            <div class="section-header">
                <h2>Section 1: Problem Definition & MECE Decomposition</h2>
                <p>Structure the revenue decline problem using MECE framework</p>
            </div>

            <div class="framework-box">
                <h4>MECE Framework: Mutually Exclusive, Collectively Exhaustive</h4>
                <p>MECE is the foundation of structured problem-solving in consulting. It requires breaking down problems into components that are:</p>
                <ul>
                    <li><strong>Mutually Exclusive:</strong> No overlap between categories (each driver counted once)</li>
                    <li><strong>Collectively Exhaustive:</strong> All drivers accounted for (nothing missing)</li>
                </ul>
                <p>For revenue problems, the classic MECE decomposition is: Revenue = Traffic × Conversion × Basket Size</p>
            </div>

            <div class="input-group">
                <label>
                    1. What was the percentage change in store traffic from 2022 to 2023?
                    <span class="tooltip">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Extract from materials: Traffic declined from 14.2M to 12.5M visitors. Calculate percentage change.</span>
                    </span>
                </label>
                <input type="text" id="trafficChange" placeholder="Enter percentage (e.g., -12%)">
                <div class="input-hint">Must calculate exact percentage from visitor numbers in materials</div>
            </div>

            <div class="input-group">
                <label>
                    2. According to customer survey data, what percentage of customers reduced shopping frequency because they switched to online grocery delivery?
                    <span class="tooltip">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Extract exact percentage from customer survey results table in materials.</span>
                    </span>
                </label>
                <input type="text" id="onlineSwitch" placeholder="Enter percentage (e.g., 45%)">
                <div class="input-hint">Find in customer survey results table</div>
            </div>

            <div class="input-group">
                <label>
                    3. Explain why traffic decline (-12%) is the PRIMARY driver of GreenLeaf's revenue problem, even though conversion rate improved. Use the MECE decomposition to support your reasoning.
                    <span class="tooltip">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Reference specific numbers: traffic -12%, conversion +7.4%, basket -4.3%. Explain what traffic decline indicates about customer behavior vs. conversion improvement.</span>
                    </span>
                </label>
                <textarea id="trafficExplanation" placeholder="Use MECE framework to explain why -12% traffic is the core problem. Reference conversion rate improvement and what this means about GreenLeaf's ability to serve customers who do visit..."></textarea>
                <div class="input-hint">Minimum 100 words. Must reference specific percentages and explain the business implication of traffic vs. conversion changes.</div>
            </div>

            <div class="example-box example-good">
                <div class="example-header" onclick="toggleExample('example1')">
                    <h4>Strong Response Example</h4>
                    <span class="example-toggle">Click to View</span>
                </div>
                <div class="example-content" id="example1">
                    <p>Traffic decline of -12% (14.2M → 12.5M visitors) is the primary driver because it represents customers choosing NOT to shop at GreenLeaf at all, rather than a failure to convert visitors into buyers. The MECE decomposition shows that while conversion rate actually improved from 68% to 73% (+7.4%), this couldn't offset the massive traffic loss. The improved conversion indicates GreenLeaf is effectively serving the customers who do visit—the problem is that far fewer customers are walking through the door. This is confirmed by survey data showing 45% of former customers switched to online delivery and 32% moved to lower-price competitors. GreenLeaf doesn't have an in-store execution problem; it has a value proposition problem. Customers are making a deliberate choice to shop elsewhere because GreenLeaf lacks online ordering (addressing the 45% who went digital) and carries an 18% price premium vs. Walmart (addressing the 32% seeking lower prices). The -4.3% basket size decline is secondary—it's an effect of the same competitive pressure, not an independent driver. The business is fundamentally losing customers to competitors offering better convenience (online) or value (discount), not losing sales from existing traffic.</p>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" onclick="prevSection()">← Previous</button>
                <button class="btn btn-primary" onclick="nextSection()">Next →</button>
            </div>
        </div>

        <!-- Section 2: Porter's Five Forces & Competitive Analysis -->
        <div class="section" id="section2">
            <div class="section-header">
                <h2>Section 2: Porter's Five Forces & Competitive Analysis</h2>
                <p>Apply Porter's framework to assess industry structure and competitive intensity</p>
            </div>

            <div class="framework-box">
                <h4>Porter's Five Forces Framework</h4>
                <p>Developed by Michael Porter, this framework analyzes industry attractiveness through five competitive forces:</p>
                <ul>
                    <li><strong>Threat of New Entrants:</strong> How easy is it for new competitors to enter?</li>
                    <li><strong>Bargaining Power of Suppliers:</strong> Can suppliers dictate terms and pricing?</li>
                    <li><strong>Bargaining Power of Buyers:</strong> How much power do customers have?</li>
                    <li><strong>Threat of Substitutes:</strong> What alternative solutions exist?</li>
                    <li><strong>Competitive Rivalry:</strong> How intense is competition among existing players?</li>
                </ul>
            </div>

            <div class="input-group">
                <label>
                    4. Based on the materials, which of Porter's Five Forces is rated as "VERY HIGH" for grocery retail?
                    <span class="tooltip">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Review the Porter's Five Forces section. One force is explicitly rated "VERY HIGH".</span>
                    </span>
                </label>
                <select id="veryHighForce">
                    <option value="">Select the force rated "VERY HIGH"...</option>
                    <option value="entrants">Threat of New Entrants</option>
                    <option value="suppliers">Bargaining Power of Suppliers</option>
                    <option value="buyers">Bargaining Power of Buyers</option>
                    <option value="substitutes">Threat of Substitutes</option>
                    <option value="rivalry">Competitive Rivalry</option>
                </select>
                <div class="input-hint">Extract exact rating from Porter's Five Forces analysis in materials</div>
            </div>

            <div class="input-group">
                <label>
                    5. What is GreenLeaf's price index compared to Walmart, and what does this reveal about buyer power?
                    <span class="tooltip">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Find in Price Sensitivity Data table. GreenLeaf = 100, Walmart = ?. Then explain the implication for buyer power.</span>
                    </span>
                </label>
                <input type="text" id="walmartPrice" placeholder="Enter Walmart's price index">
                <textarea id="buyerPowerExplanation" placeholder="Explain what this price differential reveals about buyer power in grocery retail..." style="margin-top: 10px;"></textarea>
                <div class="input-hint">Price index must be exact from table. Explanation minimum 60 words, connecting price sensitivity to buyer power rating.</div>
            </div>

            <div class="input-group">
                <label>
                    6. Synthesize Porter's Five Forces to explain why grocery retail is "structurally challenging" for a regional player like GreenLeaf. Reference at least 3 forces in your answer.
                    <span class="tooltip">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Draw from multiple forces. How do high rivalry + high substitutes + buyer power create problems specifically for a REGIONAL chain vs. national players?</span>
                    </span>
                </label>
                <textarea id="structuralAnalysis" placeholder="Explain why the combination of forces makes grocery retail difficult for regional players. Reference GreenLeaf's scale disadvantage, competitive dynamics, and customer power..."></textarea>
                <div class="input-hint">Minimum 120 words. Must reference at least 3 of the 5 forces and explain GreenLeaf's specific vulnerability as a regional player.</div>
            </div>

            <div class="example-box example-good">
                <div class="example-header" onclick="toggleExample('example2')">
                    <h4>Strong Response Example</h4>
                    <span class="example-toggle">Click to View</span>
                </div>
                <div class="example-content" id="example2">
                    <p>Grocery retail presents a structurally challenging environment for GreenLeaf due to the interaction of multiple unfavorable forces. First, competitive rivalry is VERY HIGH—the industry is fragmented with multiple formats competing (traditional chains, discount, online, specialty), and low industry growth (2-3% annually) means every player is fighting for share in a zero-sum game. GreenLeaf's $623M revenue pales against Walmart's $150B+, creating a massive scale disadvantage in supplier negotiations and technology investment. Second, the threat of substitutes is HIGH and accelerating—online grocery delivery is growing at 28% CAGR, and GreenLeaf has zero digital presence while 38% of its target customers now shop online monthly. This isn't just cannibalization within grocery; it's fundamental channel disruption that GreenLeaf is unprepared for. Third, buyer power is MEDIUM-HIGH because customers are highly price-sensitive (32% switched for lower prices), switching costs are zero, and price transparency via apps enables instant comparison. GreenLeaf's 18% price premium vs. Walmart is untenable when customers can easily defect. Finally, as a regional player, GreenLeaf faces supplier power disadvantages—major CPG brands negotiate harder terms with smaller chains, limiting GreenLeaf's ability to compete on price even if it wanted to. The combination creates a vise: intense competition from better-resourced national players, customers with high power and low loyalty, and structural cost disadvantages that prevent competitive pricing. Regional scale is a liability, not an asset.</p>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" onclick="prevSection()">← Previous</button>
                <button class="btn btn-primary" onclick="nextSection()">Next →</button>
            </div>
        </div>

        <!-- Section 3: SWOT Analysis & Strategic Positioning -->
        <div class="section" id="section3">
            <div class="section-header">
                <h2>Section 3: SWOT Analysis & Strategic Options</h2>
                <p>Map internal capabilities against external environment and evaluate strategic alternatives</p>
            </div>

            <div class="framework-box">
                <h4>SWOT Analysis Framework</h4>
                <p>SWOT identifies internal Strengths and Weaknesses, and external Opportunities and Threats. The key is finding the intersection:</p>
                <ul>
                    <li><strong>Strength + Opportunity:</strong> Where can we leverage advantages to capture growth?</li>
                    <li><strong>Weakness + Opportunity:</strong> What capabilities must we build?</li>
                    <li><strong>Strength + Threat:</strong> How do we defend our position?</li>
                    <li><strong>Weakness + Threat:</strong> What existential risks must we mitigate?</li>
                </ul>
            </div>

            <div class="input-group">
                <label>
                    7. Identify GreenLeaf's TOP strength and explain how it could be leveraged for competitive advantage
                    <span class="tooltip">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Review SWOT Strengths section. Which strength is most differentiated and hardest for competitors to replicate? How could this be weaponized?</span>
                    </span>
                </label>
                <textarea id="topStrength" placeholder="Identify GreenLeaf's most valuable strength and explain how to leverage it strategically..."></textarea>
                <div class="input-hint">Minimum 80 words. Must specify the strength and explain actionable strategy to exploit it.</div>
            </div>

            <div class="input-group">
                <label>
                    8. What is the 3-year NPV and IRR for the Omnichannel Integration strategy?
                    <span class="tooltip">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Extract exact figures from Strategic Options section for Option 1.</span>
                    </span>
                </label>
                <input type="text" id="omniNPV" placeholder="NPV (e.g., $38.2M)">
                <input type="text" id="omniIRR" placeholder="IRR (e.g., 42%)" style="margin-top: 10px;">
                <div class="input-hint">Must match exact figures from materials</div>
            </div>

            <div class="input-group">
                <label>
                    9. Why is the Omnichannel strategy superior to the Premium Local/Organic strategy, despite the latter having cultural alignment with GreenLeaf's brand? Provide financial and strategic rationale.
                    <span class="tooltip">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Compare NPV, IRR, investment required, and strategic fit. Reference the 45% of customers lost to online delivery. Explain addressable market sizing.</span>
                    </span>
                </label>
                <textarea id="strategyComparison" placeholder="Compare Omnichannel vs. Premium strategies using NPV, IRR, investment size, and strategic logic. Reference customer survey data showing why omnichannel addresses root cause..."></textarea>
                <div class="input-hint">Minimum 150 words. Must include financial metrics (NPV, IRR, investment) AND strategic reasoning (addressable market, root cause alignment).</div>
            </div>

            <div class="example-box example-good">
                <div class="example-header" onclick="toggleExample('example3')">
                    <h4>Strong Response Example</h4>
                    <span class="example-toggle">Click to View</span>
                </div>
                <div class="example-content" id="example3">
                    <p>The Omnichannel strategy is superior on both financial and strategic grounds. Financially, Omnichannel delivers $38.2M NPV vs. $21.5M for Premium—a 78% higher return—while requiring only $24.1M investment vs. $87.6M (73% less capital). The 42% IRR vs. 18% IRR means payback is faster and capital efficiency is dramatically better. But the strategic logic is even more compelling. The root cause analysis showed that 45% of lost customers switched to online grocery delivery, while only 18% preferred specialty stores like Whole Foods. Omnichannel directly addresses the largest defection driver, targeting a 45% addressable market vs. Premium's 18% niche. Moreover, 62% of surveyed customers stated they would use GreenLeaf delivery if available—this is validated demand for the Omnichannel solution. The Premium strategy, while culturally aligned with GreenLeaf's fresh produce heritage, requires massive store renovations ($54M alone) to chase a smaller, wealthier customer segment that's already well-served by Whole Foods and New Seasons. Premium also assumes GreenLeaf can command higher prices when the data shows customers are price-sensitive (32% defected to cheaper alternatives). Omnichannel leverages GreenLeaf's existing strengths—fresh produce quality, brand recognition, real estate footprint—while closing the critical capability gap (no digital channel). It's both higher-return and lower-risk because it solves the problem customers have explicitly identified rather than repositioning for a niche that may not want what GreenLeaf offers.</p>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" onclick="prevSection()">← Previous</button>
                <button class="btn btn-primary" onclick="nextSection()">Next →</button>
            </div>
        </div>

        <!-- Section 4: Implementation Planning & KPIs -->
        <div class="section" id="section4">
            <div class="section-header">
                <h2>Section 4: Implementation Planning & KPI Framework</h2>
                <p>Build actionable roadmap with measurable success metrics</p>
            </div>

            <div class="framework-box">
                <h4>Implementation & Measurement Best Practices</h4>
                <p>Strong implementation plans include:</p>
                <ul>
                    <li><strong>Phased Approach:</strong> Pilot → Scale → Optimize (de-risk through incremental rollout)</li>
                    <li><strong>Leading Indicators:</strong> Early signals that predict future performance (app downloads, weekly active users)</li>
                    <li><strong>Lagging Indicators:</strong> Outcome metrics that confirm success (revenue, margin, retention)</li>
                    <li><strong>Risk Mitigation:</strong> Pre-identified failure modes with contingency plans</li>
                </ul>
            </div>

            <div class="input-group">
                <label>
                    10. What is the Month 18 target for "Digital % of Sales" in the KPI framework?
                    <span class="tooltip">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Extract from Lagging Indicators KPI table, Month 18 Target column.</span>
                    </span>
                </label>
                <input type="text" id="digitalTarget" placeholder="Enter percentage (e.g., 18%)">
                <div class="input-hint">Find in Lagging Indicators table</div>
            </div>

            <div class="input-group">
                <label>
                    11. In Phase 1 (Months 1-4), what is the expected outcome for pilot store pickup orders per week per store?
                    <span class="tooltip">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Review Phase 1 expected outcomes in the Implementation Roadmap section.</span>
                    </span>
                </label>
                <input type="text" id="pilotOrders" placeholder="Enter orders/week/store (e.g., 150)">
                <div class="input-hint">Extract from Phase 1 expected outcomes</div>
            </div>

            <div class="input-group">
                <label>
                    12. Build a comprehensive Month 0-12 implementation plan for GreenLeaf's omnichannel rollout. Specify initiatives, sequencing, expected metrics, and key risks for each phase.
                    <span class="tooltip">
                        <span class="tooltip-icon">?</span>
                        <span class="tooltip-text">Use materials Phases 1-2 as foundation. Include specific initiatives (platform selection, Instacart partnership, pilot stores), timeline, metrics (orders/week, digital %), and risks (technology, unit economics, cannibalization).</span>
                    </span>
                </label>
                <textarea id="implementationPlan" placeholder="Detail Month 0-12 rollout plan. Include: Phase 1 (Months 1-4) initiatives and outcomes, Phase 2 (Months 5-9) initiatives and outcomes, key metrics at each milestone, primary risks and mitigation strategies..."></textarea>
                <div class="input-hint">Minimum 200 words. Must include specific initiatives, timeline, quantified metrics, and risk mitigation from materials.</div>
            </div>

            <div class="example-box example-good">
                <div class="example-header" onclick="toggleExample('example4')">
                    <h4>Strong Response Example</h4>
                    <span class="example-toggle">Click to View</span>
                </div>
                <div class="example-content" id="example4">
                    <p>GreenLeaf's omnichannel implementation follows a carefully sequenced 12-month rollout. Phase 1 (Months 1-4) establishes the foundation: select an e-commerce platform vendor (evaluate Shopify vs. custom build based on scalability and time-to-market), sign the Instacart partnership for delivery logistics infrastructure, and launch a curbside pickup pilot in 5 highest-traffic stores to validate operational model before full rollout. This phase also builds the internal team—hire a VP of Digital and 3 product managers to own the roadmap. The expected outcome is 150 orders per week per pilot store, demonstrating customer demand and proving the in-store fulfillment process works without disrupting traditional operations. This pilot de-risks technology and operations before major capital deployment. Phase 2 (Months 5-9) scales to market launch: roll out curbside pickup to all 42 stores, launch the mobile app (iOS and Android) with full online ordering capability, and begin Instacart-powered delivery in the Portland metro area (18 stores). This phase requires training 120 store associates on order fulfillment SOPs and executing a $2.5M marketing campaign targeting the 45% of lapsed customers who switched to online delivery. The expected outcome is achieving 8% of total sales through digital channels in Portland and a customer satisfaction score of 7.8/10 for pickup/delivery, validating that the customer experience meets expectations. Key metrics to track: app downloads (target 85,000 by Month 9), weekly active users (28,000), orders per week (9,500), and customer acquisition cost declining from $42 to $28 as marketing efficiency improves. Primary risks include technology execution (platform delays or poor UX), unit economics (online orders unprofitable), and operational complexity (associates struggling with dual fulfillment). Mitigations: select a proven platform vendor, target $12 contribution margin per order with minimum order values, and deploy dedicated fulfillment teams in high-volume stores rather than asking all associates to toggle between roles.</p>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" onclick="prevSection()">← Previous</button>
                <button class="btn btn-primary" onclick="calculateScore()">Complete Analysis →</button>
            </div>
        </div>

        <!-- Section 5: Results -->
        <div class="section" id="section5">
            <div class="section-header">
                <h2>Case Analysis Complete</h2>
                <p>Review your consulting case performance</p>
            </div>

            <div class="score-card">
                <h3>Your Total Score</h3>
                <div class="score-number" id="totalScore">--</div>
                <p id="scoreCategory">Calculating...</p>

                <div class="score-breakdown">
                    <div class="score-item">
                        <span class="score-label">Section 1: MECE & Problem Definition</span>
                        <span class="score-value" id="score1">--/25</span>
                    </div>
                    <div class="score-item">
                        <span class="score-label">Section 2: Porter's Five Forces</span>
                        <span class="score-value" id="score2">--/20</span>
                    </div>
                    <div class="score-item">
                        <span class="score-label">Section 3: SWOT & Strategy Selection</span>
                        <span class="score-value" id="score3">--/25</span>
                    </div>
                    <div class="score-item">
                        <span class="score-label">Section 4: Implementation & KPIs</span>
                        <span class="score-value" id="score4">--/30</span>
                    </div>
                </div>
            </div>

            <div id="detailedFeedback"></div>

            <div class="export-buttons">
                <button class="btn btn-export" onclick="downloadReport()">Download Report</button>
                <button class="btn btn-primary" onclick="location.reload()">Start New Analysis</button>
            </div>
        </div>
    </div>

    <script>
        // Initialize Supabase
        let supabaseClient;
        
        function initSupabase() {
            if (typeof window.supabase === 'undefined') {
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
                script.onload = () => {
                    supabaseClient = window.supabase.createClient(
                        'https://clhuplhaejneecbyhphh.supabase.co',
                        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsaHVwbGhhZWpuZWVjYnlocGhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjY2OTI0NzMsImV4cCI6MjA0MjI2ODQ3M30.HCW1CV2BbA5DdCd_9Q_vEoMxA-NMkPtZG2qg3hJDZLo'
                    );
                    startApp();
                };
                document.head.appendChild(script);
            } else {
                supabaseClient = window.supabase.createClient(
                    'https://clhuplhaejneecbyhphh.supabase.co',
                    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsaHVwbGhhZWpuZWVjYnlocGhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjY2OTI0NzMsImV4cCI6MjA0MjI2ODQ3M30.HCW1CV2BbA5DdCd_9Q_vEoMxA-NMkPtZG2qg3hJDZLo'
                );
                startApp();
            }
        }

        function startApp() {
            getUserEmail();
            updateProgress();
        }

        let currentSection = 0;
        const totalSections = 6;
        let userEmail = null;

        // Get user email from parent window (Webflow/Memberstack)
        function getUserEmail() {
            try {
                if (window.parent.$memberstackDom) {
                    window.parent.$memberstackDom.getCurrentMember()
                        .then(({ data: member }) => {
                            if (member) {
                                userEmail = member.auth.email;
                                loadProgress();
                            }
                        });
                } else if (localStorage.getItem('cloverpath_user_email')) {
                    userEmail = localStorage.getItem('cloverpath_user_email');
                    loadProgress();
                } else {
                    const urlParams = new URLSearchParams(window.location.search);
                    userEmail = urlParams.get('email');
                    if (userEmail) {
                        loadProgress();
                    }
                }
            } catch (error) {
                console.error('Error getting user email:', error);
            }
        }

        // Load saved progress
        async function loadProgress() {
            if (!userEmail) return;

            try {
                const { data, error } = await supabaseClient
                    .from('simulation_progress')
                    .select('*')
                    .eq('user_email', userEmail)
                    .eq('simulation_type', 'consulting_case')
                    .single();

                if (data && data.progress_data) {
                    const savedData = data.progress_data;
                    Object.keys(savedData).forEach(key => {
                        const element = document.getElementById(key);
                        if (element) {
                            if (element.type === 'checkbox') {
                                element.checked = savedData[key];
                            } else {
                                element.value = savedData[key];
                            }
                        }
                    });
                    
                    if (savedData.currentSection) {
                        currentSection = savedData.currentSection;
                        showSection(currentSection);
                    }
                }
            } catch (error) {
                console.error('Error loading progress:', error);
            }
        }

        // Save progress
        async function saveProgress() {
            if (!userEmail) return;

            const formData = {};
            
            document.querySelectorAll('input, textarea, select').forEach(element => {
                if (element.id) {
                    if (element.type === 'checkbox') {
                        formData[element.id] = element.checked;
                    } else {
                        formData[element.id] = element.value;
                    }
                }
            });

            formData.currentSection = currentSection;

            try {
                const { data, error } = await supabaseClient
                    .from('simulation_progress')
                    .upsert({
                        user_email: userEmail,
                        simulation_type: 'consulting_case',
                        progress_data: formData,
                        last_updated: new Date().toISOString()
                    }, {
                        onConflict: 'user_email,simulation_type'
                    });

                if (error) throw error;
            } catch (error) {
                console.error('Error saving progress:', error);
            }
        }

        // Auto-save on input changes
        document.addEventListener('input', () => {
            clearTimeout(window.saveTimeout);
            window.saveTimeout = setTimeout(saveProgress, 2000);
        });

        function updateProgress() {
            const progress = (currentSection / (totalSections - 1)) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressPercent').textContent = Math.round(progress) + '% Complete';
            
            const labels = ['Introduction', 'MECE & Problem Definition', "Porter's Five Forces", 'SWOT & Strategy', 'Implementation & KPIs', 'Results'];
            document.getElementById('progressLabel').textContent = labels[currentSection];
        }

        function showSection(index) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('section' + index).classList.add('active');
            currentSection = index;
            updateProgress();
            saveProgress();
            
            // Scroll parent window to top
            try {
                window.parent.postMessage({
                    type: 'scroll-to-top'
                }, '*');
            } catch (e) {
                console.error('Error scrolling parent:', e);
            }
            
            // Tell parent window to resize iframe
            setTimeout(function() {
                const height = document.body.scrollHeight + 100;
                window.parent.postMessage({
                    type: 'iframe-height',
                    height: height
                }, '*');
            }, 300);
        }

        function nextSection() {
            if (currentSection < totalSections - 1) {
                showSection(currentSection + 1);
            }
        }

        function prevSection() {
            if (currentSection > 0) {
                showSection(currentSection - 1);
            }
        }

        function toggleMaterials(id) {
            const content = document.getElementById(id);
            const box = content.closest('.materials-box');
            content.classList.toggle('show');
            
            if (content.classList.contains('show')) {
                box.querySelector('.materials-toggle').textContent = 'Click to Hide';
            } else {
                box.querySelector('.materials-toggle').textContent = 'Click to View';
            }
            
            // Send height update after content expands/collapses
            setTimeout(function() {
                const height = document.body.scrollHeight + 100;
                window.parent.postMessage({
                    type: 'iframe-height',
                    height: height
                }, '*');
            }, 100);
        }

        function toggleExample(id) {
            const content = document.getElementById(id);
            const header = content.previousElementSibling;
            const toggle = header.querySelector('.example-toggle');
            content.classList.toggle('show');
            
            if (content.classList.contains('show')) {
                toggle.textContent = 'Click to Hide';
            } else {
                toggle.textContent = 'Click to View';
            }
            
            // Send height update after content expands/collapses
            setTimeout(function() {
                const height = document.body.scrollHeight + 100;
                window.parent.postMessage({
                    type: 'iframe-height',
                    height: height
                }, '*');
            }, 100);
        }

        function parseNumber(str) {
            if (!str) return 0;
            const cleaned = str.replace(/[$,MKmk%]/g, '');
            const num = parseFloat(cleaned);
            if (str.toLowerCase().includes('m')) return num;
            if (str.toLowerCase().includes('k')) return num / 1000;
            return num;
        }

        function calculateScore() {
            let section1Score = 0;
            let section2Score = 0;
            let section3Score = 0;
            let section4Score = 0;
            let feedback = '';

            // Section 1: MECE & Problem Definition (25 points)
            const trafficChange = document.getElementById('trafficChange').value;
            const onlineSwitch = document.getElementById('onlineSwitch').value;
            const trafficExplanation = document.getElementById('trafficExplanation').value;

            feedback += '<div class="feedback-box success"><h3>Section 1: MECE & Problem Definition</h3>';

            // Q1: Traffic change (6 points)
            const trafficNum = parseFloat(trafficChange.replace(/[^0-9.-]/g, ''));
            if (trafficNum >= -12.5 && trafficNum <= -11.5) {
                section1Score += 6;
                feedback += '<p><strong>✓ Traffic Change (6/6):</strong> Correct. Traffic declined -12.0% (14.2M → 12.5M visitors).</p>';
            } else if (trafficNum >= -13 && trafficNum <= -11) {
                section1Score += 4;
                feedback += '<p><strong>⚠ Traffic Change (4/6):</strong> Close. Calculate: (12.5M - 14.2M) / 14.2M = -12.0%.</p>';
            } else {
                section1Score += 0;
                feedback += '<p><strong>✗ Traffic Change (0/6):</strong> Incorrect. Review MECE decomposition: 14.2M → 12.5M visitors = -12.0%.</p>';
            }

            // Q2: Online switch percentage (6 points)
            const onlineNum = parseFloat(onlineSwitch.replace(/[^0-9]/g, ''));
            if (onlineNum === 45) {
                section1Score += 6;
                feedback += '<p><strong>✓ Online Switch % (6/6):</strong> Correct. 45% of customers switched to online grocery delivery.</p>';
            } else {
                section1Score += 0;
                feedback += '<p><strong>✗ Online Switch % (0/6):</strong> Incorrect. Review customer survey table—45% switched to online delivery.</p>';
            }

            // Q3: Traffic explanation (13 points)
            const wordCount1 = trafficExplanation.trim().split(/\s+/).length;
            const hasMECE = trafficExplanation.toLowerCase().includes('mece');
            const hasTraffic12 = trafficExplanation.includes('12') || trafficExplanation.includes('-12');
            const hasConversion = trafficExplanation.includes('73') || trafficExplanation.includes('7.4') || trafficExplanation.includes('conversion');
            const has45Online = trafficExplanation.includes('45') && trafficExplanation.toLowerCase().includes('online');
            const hasValueProp = trafficExplanation.toLowerCase().includes('value proposition') || trafficExplanation.toLowerCase().includes('choosing not to shop');

            let explanation1Score = 0;
            if (wordCount1 >= 100) explanation1Score += 3;
            else if (wordCount1 >= 80) explanation1Score += 2;
            if (hasMECE) explanation1Score += 2;
            if (hasTraffic12) explanation1Score += 2;
            if (hasConversion) explanation1Score += 2;
            if (has45Online) explanation1Score += 2;
            if (hasValueProp) explanation1Score += 2;

            section1Score += explanation1Score;
            if (explanation1Score >= 11) {
                feedback += '<p><strong>✓ Traffic Explanation (' + explanation1Score + '/13):</strong> Strong MECE-based analysis connecting traffic decline to root causes.</p>';
            } else if (explanation1Score >= 7) {
                feedback += '<p><strong>⚠ Traffic Explanation (' + explanation1Score + '/13):</strong> Good foundation but missing key elements. Reference -12% traffic, +7.4% conversion, 45% online switch, and explain why traffic loss (not conversion) is the core problem.</p>';
            } else {
                feedback += '<p><strong>✗ Traffic Explanation (' + explanation1Score + '/13):</strong> Insufficient detail. Must use MECE framework, cite specific metrics, and explain business implication.</p>';
            }

            feedback += '</div>';

            // Section 2: Porter's Five Forces (20 points)
            const veryHighForce = document.getElementById('veryHighForce').value;
            const walmartPrice = document.getElementById('walmartPrice').value;
            const buyerPowerExplanation = document.getElementById('buyerPowerExplanation').value;
            const structuralAnalysis = document.getElementById('structuralAnalysis').value;

            feedback += '<div class="feedback-box success"><h3>Section 2: Porter\'s Five Forces</h3>';

            // Q4: Very High force (5 points)
            if (veryHighForce === 'rivalry') {
                section2Score += 5;
                feedback += '<p><strong>✓ VERY HIGH Force (5/5):</strong> Correct. Competitive Rivalry is rated VERY HIGH in the materials.</p>';
            } else {
                section2Score += 0;
                feedback += '<p><strong>✗ VERY HIGH Force (0/5):</strong> Incorrect. Review Porter\'s section—Competitive Rivalry is the only force rated VERY HIGH.</p>';
            }

            // Q5: Walmart price + buyer power (6 points: 3 for price, 3 for explanation)
            const priceNum = parseFloat(walmartPrice.replace(/[^0-9]/g, ''));
            if (priceNum === 82) {
                section2Score += 3;
                feedback += '<p><strong>✓ Walmart Price Index (3/3):</strong> Correct—82 (18% cheaper than GreenLeaf).</p>';
            } else {
                section2Score += 0;
                feedback += '<p><strong>✗ Walmart Price Index (0/3):</strong> Incorrect. Price table shows Walmart at 82 (18% cheaper).</p>';
            }

            const buyerWordCount = buyerPowerExplanation.trim().split(/\s+/).length;
            const buyerHas18 = buyerPowerExplanation.includes('18');
            const buyerHasPower = buyerPowerExplanation.toLowerCase().includes('power') || buyerPowerExplanation.toLowerCase().includes('price-sensitive');

            if (buyerWordCount >= 60 && buyerHas18 && buyerHasPower) {
                section2Score += 3;
                feedback += '<p><strong>✓ Buyer Power Explanation (3/3):</strong> Clear connection between price differential and buyer power.</p>';
            } else if (buyerWordCount >= 40) {
                section2Score += 1;
                feedback += '<p><strong>⚠ Buyer Power Explanation (1/3):</strong> Needs more detail on how 18% price premium demonstrates high buyer power.</p>';
            } else {
                section2Score += 0;
                feedback += '<p><strong>✗ Buyer Power Explanation (0/3):</strong> Insufficient. Explain how large price gaps prove customers have power to switch.</p>';
            }

            // Q6: Structural analysis (9 points)
            const structWordCount = structuralAnalysis.trim().split(/\s+/).length;
            const hasRivalry = structuralAnalysis.toLowerCase().includes('rivalry') || structuralAnalysis.toLowerCase().includes('competition');
            const hasSubstitutes = structuralAnalysis.toLowerCase().includes('substitute') || structuralAnalysis.toLowerCase().includes('online');
            const hasBuyers = structuralAnalysis.toLowerCase().includes('buyer') || structuralAnalysis.toLowerCase().includes('price-sensitive');
            const hasScale = structuralAnalysis.toLowerCase().includes('scale') || structuralAnalysis.toLowerCase().includes('regional');
            const has623M = structuralAnalysis.includes('623') || structuralAnalysis.includes('$623');

            let structScore = 0;
            if (structWordCount >= 120) structScore += 3;
            else if (structWordCount >= 90) structScore += 2;
            if (hasRivalry) structScore += 1.5;
            if (hasSubstitutes) structScore += 1.5;
            if (hasBuyers) structScore += 1.5;
            if (hasScale) structScore += 1;
            if (has623M) structScore += 0.5;

            section2Score += Math.min(9, structScore);
            if (structScore >= 7) {
                feedback += '<p><strong>✓ Structural Analysis (' + Math.min(9, structScore).toFixed(1) + '/9):</strong> Comprehensive synthesis of multiple forces and regional disadvantage.</p>';
            } else if (structScore >= 4) {
                feedback += '<p><strong>⚠ Structural Analysis (' + Math.min(9, structScore).toFixed(1) + '/9):</strong> Good start but needs reference to at least 3 forces. Explain GreenLeaf\'s $623M scale vs. national competitors, high rivalry, substitute threat, buyer power.</p>';
            } else {
                feedback += '<p><strong>✗ Structural Analysis (' + Math.min(9, structScore).toFixed(1) + '/9):</strong> Insufficient. Must reference 3+ forces and explain regional player vulnerability.</p>';
            }

            feedback += '</div>';

            // Section 3: SWOT & Strategy (25 points)
            const topStrength = document.getElementById('topStrength').value;
            const omniNPV = document.getElementById('omniNPV').value;
            const omniIRR = document.getElementById('omniIRR').value;
            const strategyComparison = document.getElementById('strategyComparison').value;

            feedback += '<div class="feedback-box success"><h3>Section 3: SWOT & Strategy Selection</h3>';

            // Q7: Top strength (6 points)
            const strengthWordCount = topStrength.trim().split(/\s+/).length;
            const hasProduce = topStrength.toLowerCase().includes('produce') || topStrength.toLowerCase().includes('fresh');
            const hasRanking = topStrength.includes('87') || topStrength.includes('#1');
            const hasLeverage = topStrength.toLowerCase().includes('leverage') || topStrength.toLowerCase().includes('differentiat');

            let strengthScore = 0;
            if (strengthWordCount >= 80) strengthScore += 2;
            if (hasProduce) strengthScore += 2;
            if (hasRanking) strengthScore += 1;
            if (hasLeverage) strengthScore += 1;

            section3Score += strengthScore;
            if (strengthScore >= 5) {
                feedback += '<p><strong>✓ Top Strength (' + strengthScore + '/6):</strong> Clear identification and strategic application of key strength.</p>';
            } else {
                feedback += '<p><strong>⚠ Top Strength (' + strengthScore + '/6):</strong> Should identify Fresh Produce (#1 ranking, 87% satisfaction) and explain how to leverage in strategy.</p>';
            }

            // Q8: Omnichannel NPV & IRR (6 points: 3 + 3)
            const npvNum = parseNumber(omniNPV);
            const irrNum = parseFloat(omniIRR.replace(/[^0-9]/g, ''));

            if (npvNum >= 38 && npvNum <= 38.5) {
                section3Score += 3;
                feedback += '<p><strong>✓ Omnichannel NPV (3/3):</strong> Correct—$38.2M.</p>';
            } else {
                section3Score += 0;
                feedback += '<p><strong>✗ Omnichannel NPV (0/3):</strong> Incorrect. Materials state $38.2M NPV for Option 1.</p>';
            }

            if (irrNum === 42) {
                section3Score += 3;
                feedback += '<p><strong>✓ Omnichannel IRR (3/3):</strong> Correct—42%.</p>';
            } else {
                section3Score += 0;
                feedback += '<p><strong>✗ Omnichannel IRR (0/3):</strong> Incorrect. Materials state 42% IRR for Option 1.</p>';
            }

            // Q9: Strategy comparison (10 points)
            const compWordCount = strategyComparison.trim().split(/\s+/).length;
            const hasNPV38 = strategyComparison.includes('38.2') || strategyComparison.includes('38');
            const hasNPV21 = strategyComparison.includes('21.5') || strategyComparison.includes('21');
            const has42IRR = strategyComparison.includes('42');
            const has45percent = strategyComparison.includes('45');
            const hasInvestment = strategyComparison.includes('24.1') || strategyComparison.includes('87.6');
            const hasAddressable = strategyComparison.toLowerCase().includes('addressable') || strategyComparison.toLowerCase().includes('root cause');

            let compScore = 0;
            if (compWordCount >= 150) compScore += 3;
            else if (compWordCount >= 120) compScore += 2;
            if (hasNPV38 && hasNPV21) compScore += 2;
            if (has42IRR) compScore += 1;
            if (has45percent) compScore += 2;
            if (hasInvestment) compScore += 1;
            if (hasAddressable) compScore += 1;

            section3Score += compScore;
            if (compScore >= 8) {
                feedback += '<p><strong>✓ Strategy Comparison (' + compScore + '/10):</strong> Comprehensive financial and strategic justification.</p>';
            } else if (compScore >= 5) {
                feedback += '<p><strong>⚠ Strategy Comparison (' + compScore + '/10):</strong> Good analysis but missing key elements. Include NPV comparison ($38.2M vs. $21.5M), investment ($24.1M vs. $87.6M), and 45% customer defection to online.</p>';
            } else {
                feedback += '<p><strong>✗ Strategy Comparison (' + compScore + '/10):</strong> Insufficient justification. Must compare financial metrics AND explain why omnichannel addresses root cause.</p>';
            }

            feedback += '</div>';

            // Section 4: Implementation & KPIs (30 points)
            const digitalTarget = document.getElementById('digitalTarget').value;
            const pilotOrders = document.getElementById('pilotOrders').value;
            const implementationPlan = document.getElementById('implementationPlan').value;

            feedback += '<div class="feedback-box success"><h3>Section 4: Implementation & KPIs</h3>';

            // Q10: Digital target (6 points)
            const digitalNum = parseFloat(digitalTarget.replace(/[^0-9]/g, ''));
            if (digitalNum === 18) {
                section4Score += 6;
                feedback += '<p><strong>✓ Digital % Target (6/6):</strong> Correct—18% by Month 18.</p>';
            } else {
                section4Score += 0;
                feedback += '<p><strong>✗ Digital % Target (0/6):</strong> Incorrect. Lagging Indicators table shows 18% target at Month 18.</p>';
            }

            // Q11: Pilot orders (6 points)
            const pilotNum = parseFloat(pilotOrders.replace(/[^0-9]/g, ''));
            if (pilotNum === 150) {
                section4Score += 6;
                feedback += '<p><strong>✓ Pilot Orders (6/6):</strong> Correct—150 orders/week/store in Phase 1.</p>';
            } else {
                section4Score += 0;
                feedback += '<p><strong>✗ Pilot Orders (0/6):</strong> Incorrect. Phase 1 expected outcome is 150 orders/week/store.</p>';
            }

            // Q12: Implementation plan (18 points)
            const implWordCount = implementationPlan.trim().split(/\s+/).length;
            const hasPhase1 = implementationPlan.toLowerCase().includes('phase 1') || implementationPlan.includes('month') && implementationPlan.includes('4');
            const hasPhase2 = implementationPlan.toLowerCase().includes('phase 2') || implementationPlan.includes('5-9');
            const hasInstacart = implementationPlan.toLowerCase().includes('instacart');
            const hasPilot = implementationPlan.includes('150') || implementationPlan.toLowerCase().includes('pilot');
            const has8percent = implementationPlan.includes('8%');
            const hasMetrics = implementationPlan.toLowerCase().includes('app download') || implementationPlan.toLowerCase().includes('weekly active');
            const hasRisks = implementationPlan.toLowerCase().includes('risk') && (implementationPlan.toLowerCase().includes('technology') || implementationPlan.toLowerCase().includes('unit economic'));

            let implScore = 0;
            if (implWordCount >= 200) implScore += 5;
            else if (implWordCount >= 150) implScore += 3;
            if (hasPhase1) implScore += 3;
            if (hasPhase2) implScore += 3;
            if (hasInstacart) implScore += 2;
            if (hasPilot) implScore += 2;
            if (has8percent) implScore += 1;
            if (hasMetrics) implScore += 1;
            if (hasRisks) implScore += 1;

            section4Score += Math.min(18, implScore);
            if (implScore >= 15) {
                feedback += '<p><strong>✓ Implementation Plan (' + Math.min(18, implScore) + '/18):</strong> Comprehensive roadmap with phases, initiatives, metrics, and risks.</p>';
            } else if (implScore >= 10) {
                feedback += '<p><strong>⚠ Implementation Plan (' + Math.min(18, implScore) + '/18):</strong> Good structure but missing details. Include Phase 1 (pilot 5 stores, Instacart partnership, 150 orders/week), Phase 2 (42-store rollout, 8% digital sales), metrics, and risks.</p>';
            } else {
                feedback += '<p><strong>✗ Implementation Plan (' + Math.min(18, implScore) + '/18):</strong> Insufficient detail. Must outline phased approach with specific initiatives and outcomes from materials.</p>';
            }

            feedback += '</div>';

            // Calculate total and display
            const totalScore = section1Score + section2Score + section3Score + section4Score;

            document.getElementById('score1').textContent = section1Score.toFixed(1) + '/25';
            document.getElementById('score2').textContent = section2Score.toFixed(1) + '/20';
            document.getElementById('score3').textContent = section3Score.toFixed(1) + '/25';
            document.getElementById('score4').textContent = section4Score.toFixed(1) + '/30';
            document.getElementById('totalScore').textContent = totalScore.toFixed(0);

            let category = '';
            if (totalScore >= 90) {
                category = 'Outstanding - MBB Consultant Level';
            } else if (totalScore >= 80) {
                category = 'Strong - Solid Consulting Frameworks';
            } else if (totalScore >= 70) {
                category = 'Good - Competent Analysis';
            } else if (totalScore >= 60) {
                category = 'Adequate - Basic Framework Understanding';
            } else {
                category = 'Needs Improvement - Review Materials';
            }

            document.getElementById('scoreCategory').textContent = category;
            document.getElementById('detailedFeedback').innerHTML = feedback;

            // Save final score to Supabase
            if (userEmail) {
                saveResults(totalScore, section1Score, section2Score, section3Score, section4Score);
            }

            showSection(5);
        }

        async function saveResults(totalScore, section1Score, section2Score, section3Score, section4Score) {
            try {
                await supabaseClient
                    .from('simulation_results')
                    .upsert({
                        user_email: userEmail,
                        simulation_type: 'consulting_case',
                        total_score: Math.round(totalScore),
                        section_scores: {
                            mece_problem: section1Score,
                            porters_five: section2Score,
                            swot_strategy: section3Score,
                            implementation: section4Score
                        },
                        completed_at: new Date().toISOString()
                    }, {
                        onConflict: 'user_email,simulation_type'
                    });
            } catch (error) {
                console.error('Error saving results:', error);
            }
        }

        function downloadReport() {
            const reportContent = `
GREENLEAF GROCERY CONSULTING CASE - ANALYSIS REPORT
Generated: ${new Date().toLocaleDateString()}

TOTAL SCORE: ${document.getElementById('totalScore').textContent}/100

SCORE BREAKDOWN:
- Section 1: MECE & Problem Definition: ${document.getElementById('score1').textContent}
- Section 2: Porter's Five Forces: ${document.getElementById('score2').textContent}
- Section 3: SWOT & Strategy Selection: ${document.getElementById('score3').textContent}
- Section 4: Implementation & KPIs: ${document.getElementById('score4').textContent}

PERFORMANCE CATEGORY: ${document.getElementById('scoreCategory').textContent}

YOUR RESPONSES:

Section 1: MECE & Problem Definition
1. Traffic Change: ${document.getElementById('trafficChange').value}
2. Online Switch %: ${document.getElementById('onlineSwitch').value}
3. Traffic Explanation: ${document.getElementById('trafficExplanation').value}

Section 2: Porter's Five Forces
4. VERY HIGH Force: ${document.getElementById('veryHighForce').value}
5. Walmart Price Index: ${document.getElementById('walmartPrice').value}
   Buyer Power Explanation: ${document.getElementById('buyerPowerExplanation').value}
6. Structural Analysis: ${document.getElementById('structuralAnalysis').value}

Section 3: SWOT & Strategy
7. Top Strength: ${document.getElementById('topStrength').value}
8. Omnichannel NPV: ${document.getElementById('omniNPV').value}
   Omnichannel IRR: ${document.getElementById('omniIRR').value}
9. Strategy Comparison: ${document.getElementById('strategyComparison').value}

Section 4: Implementation & KPIs
10. Digital % Target: ${document.getElementById('digitalTarget').value}
11. Pilot Orders: ${document.getElementById('pilotOrders').value}
12. Implementation Plan: ${document.getElementById('implementationPlan').value}

DETAILED FEEDBACK:
${document.getElementById('detailedFeedback').innerText}
            `;

            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'GreenLeaf_Consulting_Case_Report.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Initialize
        initSupabase();
        
        // Send height to parent window for iframe resizing
        function sendHeightToParent() {
            try {
                const height = document.body.scrollHeight + 100;
                window.parent.postMessage({
                    type: 'iframe-height',
                    height: height
                }, '*');
            } catch (e) {
                console.error('Error sending height:', e);
            }
        }
        
        // Send height on load only
        window.addEventListener('load', function() {
            setTimeout(sendHeightToParent, 500);
            setTimeout(sendHeightToParent, 1500);
        });
    </script>
    
    <div id="content-end-marker" style="height: 1px; margin: 0; padding: 0;"></div>
</body>
</html>
