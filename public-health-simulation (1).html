<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Public Health Simulation - Maternal-Infant Health - Cloverpath</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body, html {
            overflow-x: hidden;
            width: 100%;
        }

        p, h1, h2, h3, h4, h5, h6, li, td, th, div, span {
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
        }

        :root {
            --primary-green: #2d8659;
            --light-green: #7cb342;
            --dark-green: #1b5e3a;
            --light-green-dark: #5a9c2e;
            --bg-light: #f5f9f7;
            --text-dark: #1a1a1a;
            --text-gray: #666;
            --border-color: #e0e0e0;
            --white: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            overflow-x: hidden;
            width: 100%;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--dark-green) 100%);
            color: var(--white);
            padding: 40px 20px;
            text-align: center;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .progress-container {
            background: var(--white);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: var(--border-color);
            border-radius: 6px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-green) 0%, var(--light-green) 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--text-gray);
        }

        .company-banner {
            background: linear-gradient(135deg, #5a9c2e 0%, #7cb342 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .company-banner h2 {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .program-info {
            background: white;
            border: 2px solid var(--primary-green);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .program-info h3 {
            color: var(--primary-green);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-item {
            padding: 12px;
            background: var(--bg-light);
            border-radius: 8px;
            border-left: 4px solid var(--primary-green);
        }

        .stat-item strong {
            display: block;
            color: var(--primary-green);
            font-size: 0.85rem;
            margin-bottom: 4px;
        }

        .stat-item span {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .section {
            display: none;
            background: var(--white);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .section.active {
            display: block;
        }

        .section-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--primary-green);
        }

        .section-header h2 {
            color: var(--primary-green);
            font-size: 1.8rem;
            margin-bottom: 8px;
        }

        .materials-box {
            background: var(--white);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .materials-header {
            background: var(--white);
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }

        .materials-header:hover {
            background: var(--bg-light);
        }

        .materials-header h3 {
            color: var(--primary-green);
            font-size: 1.2rem;
            margin: 0;
        }

        .materials-toggle {
            font-size: 1.5rem;
            color: var(--primary-green);
            font-weight: bold;
        }

        .materials-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .materials-content.open {
            max-height: 8000px;
        }

        .materials-inner {
            padding: 25px;
            border-top: 1px solid var(--border-color);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-dark);
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-green);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-right: 10px;
        }

        .btn-primary {
            background: var(--primary-green);
            color: white;
        }

        .btn-primary:hover {
            background: var(--dark-green);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: white;
            color: var(--primary-green);
            border: 2px solid var(--primary-green);
        }

        .btn-secondary:hover {
            background: var(--bg-light);
        }

        .feedback-box {
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .feedback-box.success {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
        }

        .feedback-box.warning {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
        }

        .feedback-box.error {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .data-table th {
            background: var(--light-green-dark);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .data-table tr:hover {
            background: var(--bg-light);
        }

        .score-card {
            background: linear-gradient(135deg, var(--primary-green) 0%, var(--light-green) 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 30px;
        }

        .score-card h2 {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .score-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .score-item {
            background: white;
            color: var(--text-dark);
            padding: 15px;
            border-radius: 8px;
        }

        .score-item h4 {
            color: var(--primary-green);
            margin-bottom: 5px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .company-banner h2 {
                font-size: 1.5rem;
            }

            .stat-grid {
                grid-template-columns: 1fr;
            }

            .btn {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Public Health Simulation</h1>
            <p>Design a maternal-infant health intervention to reduce community infant mortality</p>
        </div>

        <div class="progress-container">
            <h3>Your Progress</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text">
                <span id="progressLabel">Introduction</span>
                <span id="progressPercent">0% Complete</span>
            </div>
        </div>

        <div class="company-banner">
            <h2>Metro Health Department</h2>
            <p>Community Health Division - Maternal & Child Health Program</p>
        </div>

        <!-- Section 0: Introduction -->
        <div class="section active" id="section0">
            <div class="section-header">
                <h2>Welcome to Your Public Health Assignment</h2>
                <p>Review community health data and design an evidence-based maternal-infant health intervention</p>
            </div>

            <div class="feedback-box success">
                <h3 style="margin-bottom: 10px;">Your Role</h3>
                <p><strong>Position:</strong> Public Health Program Coordinator Intern</p>
                <p><strong>Supervisor:</strong> Dr. Jennifer Kim, MPH, DrPH</p>
                <p><strong>Project Duration:</strong> 12-month intervention program</p>
                <p><strong>Your Mission:</strong> Design and implement a community-based intervention to reduce infant mortality by 20% through improved maternal health outcomes.</p>
            </div>

            <div class="program-info">
                <h3>Program Overview: Healthy Beginnings Initiative</h3>
                <p><strong>Goal:</strong> Reduce infant mortality rate from 10.2 per 1,000 to 8.2 per 1,000 (20% reduction)</p>
                
                <div class="stat-grid">
                    <div class="stat-item">
                        <strong>Current Mortality</strong>
                        <span>10.2 per 1,000</span>
                    </div>
                    <div class="stat-item">
                        <strong>Target Rate</strong>
                        <span>8.2 per 1,000</span>
                    </div>
                    <div class="stat-item">
                        <strong>Annual Budget</strong>
                        <span>$380,000</span>
                    </div>
                    <div class="stat-item">
                        <strong>Target Participants</strong>
                        <span>400 women/year</span>
                    </div>
                </div>
            </div>

            <div class="materials-box">
                <div class="materials-header" onclick="toggleMaterials()">
                    <h3>Community Health Data & Resources</h3>
                    <span class="materials-toggle" id="materialsToggle">+</span>
                </div>
                <div class="materials-content" id="materialsContent">
                    <div class="materials-inner">
                        <h4 style="color: var(--primary-green); margin-bottom: 15px;">Infant Mortality by Zip Code</h4>
                        
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Zip Code</th>
                                    <th>Live Births/Year</th>
                                    <th>Deaths/Year</th>
                                    <th>Rate per 1,000</th>
                                    <th>Median Income</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr style="background: #ffebee;">
                                    <td>10801</td>
                                    <td>520</td>
                                    <td>9</td>
                                    <td>17.3</td>
                                    <td>$28,400</td>
                                </tr>
                                <tr style="background: #ffebee;">
                                    <td>10802</td>
                                    <td>680</td>
                                    <td>10</td>
                                    <td>14.7</td>
                                    <td>$31,200</td>
                                </tr>
                                <tr style="background: #ffebee;">
                                    <td>10803</td>
                                    <td>440</td>
                                    <td>6</td>
                                    <td>13.6</td>
                                    <td>$29,800</td>
                                </tr>
                                <tr style="background: #e8f5e9;">
                                    <td>10804</td>
                                    <td>590</td>
                                    <td>5</td>
                                    <td>8.5</td>
                                    <td>$42,100</td>
                                </tr>
                                <tr style="background: #e8f5e9;">
                                    <td>10805</td>
                                    <td>720</td>
                                    <td>3</td>
                                    <td>4.2</td>
                                    <td>$68,900</td>
                                </tr>
                                <tr style="background: #e8f5e9;">
                                    <td>10806</td>
                                    <td>650</td>
                                    <td>2</td>
                                    <td>3.1</td>
                                    <td>$74,200</td>
                                </tr>
                            </tbody>
                        </table>

                        <h4 style="color: var(--primary-green); margin: 25px 0 15px 0;">Leading Causes of Infant Mortality</h4>
                        
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Cause</th>
                                    <th>Deaths/Year</th>
                                    <th>Percentage</th>
                                    <th>Preventability</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Prematurity/Low Birth Weight</td>
                                    <td>11</td>
                                    <td>44%</td>
                                    <td>Moderate</td>
                                </tr>
                                <tr>
                                    <td>Sleep-Related (SIDS)</td>
                                    <td>7</td>
                                    <td>28%</td>
                                    <td>High</td>
                                </tr>
                                <tr>
                                    <td>Congenital Abnormalities</td>
                                    <td>4</td>
                                    <td>16%</td>
                                    <td>Low</td>
                                </tr>
                                <tr>
                                    <td>Maternal Complications</td>
                                    <td>2</td>
                                    <td>8%</td>
                                    <td>Moderate</td>
                                </tr>
                            </tbody>
                        </table>

                        <h4 style="color: var(--primary-green); margin: 25px 0 15px 0;">Evidence-Based Interventions</h4>
                        
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Intervention</th>
                                    <th>Effectiveness</th>
                                    <th>Cost/Participant</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Home Visiting</td>
                                    <td>25% reduction preterm</td>
                                    <td>$1,200/year</td>
                                </tr>
                                <tr>
                                    <td>Safe Sleep Education</td>
                                    <td>40% reduction SIDS</td>
                                    <td>$80 one-time</td>
                                </tr>
                                <tr>
                                    <td>Group Prenatal Care</td>
                                    <td>33% reduction preterm</td>
                                    <td>$950/pregnancy</td>
                                </tr>
                                <tr>
                                    <td>Breastfeeding Support</td>
                                    <td>60% increase exclusive BF</td>
                                    <td>$240/participant</td>
                                </tr>
                                <tr>
                                    <td>Text Message Reminders</td>
                                    <td>28% increase appointments</td>
                                    <td>$45/participant</td>
                                </tr>
                                <tr>
                                    <td>Community Health Workers</td>
                                    <td>40% increase prenatal visits</td>
                                    <td>$680/participant</td>
                                </tr>
                                <tr>
                                    <td>Transportation Assistance</td>
                                    <td>35% increase visit completion</td>
                                    <td>$320/participant</td>
                                </tr>
                            </tbody>
                        </table>

                        <h4 style="color: var(--primary-green); margin: 25px 0 15px 0;">Demographics - High-Risk Zip Codes (10801-10803)</h4>
                        
                        <ul style="margin-left: 20px;">
                            <li><strong>Hispanic/Latino:</strong> 52%</li>
                            <li><strong>Primary language Spanish:</strong> 46%</li>
                            <li><strong>Uninsured:</strong> 36%</li>
                            <li><strong>Single-parent households:</strong> 44%</li>
                            <li><strong>Undocumented population:</strong> 34%</li>
                            <li><strong>Teen pregnancies:</strong> 18%</li>
                        </ul>

                        <h4 style="color: var(--primary-green); margin: 25px 0 15px 0;">Access Barriers (Survey Data)</h4>
                        
                        <ul style="margin-left: 20px;">
                            <li><strong>Transportation (62%):</strong> No car, long bus commute</li>
                            <li><strong>Work schedule (54%):</strong> Can't take time off</li>
                            <li><strong>Language barriers (38%):</strong> No Spanish-speaking staff</li>
                            <li><strong>Insurance/cost (35%):</strong> Medicaid pending</li>
                            <li><strong>Immigration concerns:</strong> Fear of seeking services</li>
                        </ul>
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" onclick="showSection(1)">Begin Simulation</button>
        </div>

        <!-- Section 1: Needs Assessment (25 points) -->
        <div class="section" id="section1">
            <div class="section-header">
                <h2>Section 1: Needs Assessment & Priority Setting</h2>
                <p>Analyze community data to identify priority populations</p>
            </div>

            <div class="feedback-box warning">
                <strong>Your Task:</strong> Analyze infant mortality data and recommend which zip codes to prioritize. You have limited resources - make strategic decisions about where to focus for maximum impact.
            </div>

            <div class="form-group">
                <label>Q1: How many total infant deaths occurred in the three highest-risk zip codes (10801, 10802, 10803)?</label>
                <input type="number" id="totalDeaths" placeholder="Enter total deaths">
            </div>

            <div class="form-group">
                <label>Q2: What percentage of all community infant deaths occur in these three high-risk zip codes? (Total = 35 deaths)</label>
                <input type="number" id="deathPercentage" step="0.1" placeholder="Enter percentage (e.g., 71.4)">
            </div>

            <div class="form-group">
                <label>Q3: Which cause of infant death is BOTH highly prevalent AND highly preventable?</label>
                <select id="preventableCause">
                    <option value="">-- Select Answer --</option>
                    <option value="prematurity">Prematurity/Low Birth Weight (44%, moderate preventability)</option>
                    <option value="sleep">Sleep-Related Deaths (28%, high preventability)</option>
                    <option value="congenital">Congenital Abnormalities (16%, low preventability)</option>
                    <option value="maternal">Maternal Complications (8%, moderate preventability)</option>
                </select>
            </div>

            <div class="form-group">
                <label>Q4: Needs Assessment Summary - Justify your priority population and intervention focus (150+ words)</label>
                <textarea id="needsAssessment" placeholder="Based on data, explain: (1) Which zip codes to prioritize, (2) Which causes to target, (3) Social determinants to address, (4) How demographics inform program design"></textarea>
            </div>

            <button class="btn btn-secondary" onclick="showSection(0)">Back</button>
            <button class="btn btn-primary" onclick="showSection(2)">Next Section</button>
        </div>

        <!-- Section 2: Program Design (20 points) -->
        <div class="section" id="section2">
            <div class="section-header">
                <h2>Section 2: Program Design & Cultural Competency</h2>
                <p>Design evidence-based, culturally appropriate interventions</p>
            </div>

            <div class="feedback-box success">
                <p><strong>Budget:</strong> $380,000 to serve 400 participants ($950/participant for interventions)</p>
                <p><strong>Population:</strong> 52% Hispanic, 46% Spanish-speaking, 34% undocumented</p>
                <p><strong>Barriers:</strong> Transportation, language, work schedules, immigration concerns</p>
            </div>

            <div class="form-group">
                <label>Q5: If you implement safe sleep ($80) + breastfeeding ($240) + text reminders ($45) for all 400 participants, what is total cost?</label>
                <input type="number" id="interventionCost" placeholder="Enter total cost">
            </div>

            <div class="form-group">
                <label>Q6: Which intensive service provides BEST cost-effectiveness for reducing preterm births?</label>
                <select id="intensiveService">
                    <option value="">-- Select Answer --</option>
                    <option value="home">Home Visiting ($1,200, 25% reduction)</option>
                    <option value="centering">Group Prenatal Care ($950, 33% reduction)</option>
                    <option value="chw">Community Health Workers ($680, 40% increase visits)</option>
                    <option value="transport">Transportation ($320, 35% increase completion)</option>
                </select>
            </div>

            <div class="form-group">
                <label>Q7: For 46% Spanish-speaking population, which staffing approach is MOST culturally competent?</label>
                <select id="staffingApproach">
                    <option value="">-- Select Answer --</option>
                    <option value="translators">On-call translators</option>
                    <option value="bilingual">All staff bilingual Spanish/English</option>
                    <option value="chw">Community Health Workers from target neighborhoods</option>
                    <option value="materials">Spanish materials with English-speaking staff</option>
                </select>
            </div>

            <div class="form-group">
                <label>Q8: Program Design Rationale - Explain intervention selection and cultural approach (150+ words)</label>
                <textarea id="programDesign" placeholder="Describe: (1) Selected interventions with effectiveness data, (2) Cultural/language strategies, (3) Immigration concern solutions, (4) Transportation/work accommodations"></textarea>
            </div>

            <button class="btn btn-secondary" onclick="showSection(1)">Back</button>
            <button class="btn btn-primary" onclick="showSection(3)">Next Section</button>
        </div>

        <!-- Section 3: Community Engagement (25 points) -->
        <div class="section" id="section3">
            <div class="section-header">
                <h2>Section 3: Community Engagement & Partnerships</h2>
                <p>Build trust and collaborate with stakeholders</p>
            </div>

            <div class="feedback-box warning">
                <p><strong>Challenge:</strong> After 8 weeks, only 32/80 target women enrolled. Exit interviews reveal:</p>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>"Worried about immigration consequences"</li>
                    <li>"Don't know anyone who's done it"</li>
                    <li>"Not for people like me"</li>
                </ul>
            </div>

            <div class="form-group">
                <label>Q9: Given 34% undocumented population, which partner builds MOST trust?</label>
                <select id="trustPartner">
                    <option value="">-- Select Answer --</option>
                    <option value="hospital">Metro General Hospital (government-affiliated)</option>
                    <option value="familia">La Familia Resource Center (community organization, non-governmental)</option>
                    <option value="medicaid">Medicaid Plans (requires documentation)</option>
                    <option value="health">Community Health Centers (may require ID)</option>
                </select>
            </div>

            <div class="form-group">
                <label>Q10: To reach women early in pregnancy, which outreach strategy leverages community trust MOST?</label>
                <select id="outreachStrategy">
                    <option value="">-- Select Answer --</option>
                    <option value="social">Social media ads</option>
                    <option value="clinic">Flyers at clinics/WIC offices</option>
                    <option value="faith">Presentations at 14 churches with faith leader endorsement</option>
                    <option value="text">Text message campaigns</option>
                </select>
            </div>

            <div class="form-group">
                <label>Q11: How should you integrate community doulas to maximize trust AND effectiveness?</label>
                <select id="doulaIntegration">
                    <option value="">-- Select Answer --</option>
                    <option value="hire">Hire as full-time staff</option>
                    <option value="contract">Contract on fee-per-birth basis</option>
                    <option value="peer">Train as peer educators + navigators for ongoing support</option>
                    <option value="refer">Provide referrals only</option>
                </select>
            </div>

            <div class="form-group">
                <label>Q12: Community Engagement Strategy - How will you rebuild trust and increase enrollment? (150+ words)</label>
                <textarea id="engagementStrategy" placeholder="Explain: (1) Immigration fear solutions, (2) Community partnerships, (3) Peer support role, (4) Culturally resonant messaging, (5) Sustainability plans"></textarea>
            </div>

            <button class="btn btn-secondary" onclick="showSection(2)">Back</button>
            <button class="btn btn-primary" onclick="showSection(4)">Next Section</button>
        </div>

        <!-- Section 4: Evaluation (30 points) -->
        <div class="section" id="section4">
            <div class="section-header">
                <h2>Section 4: Evaluation & Outcomes Measurement</h2>
                <p>Design evaluation plan and calculate impact</p>
            </div>

            <div class="feedback-box success">
                <p><strong>12-Month Results (High-Risk Zip Codes 10801-10803):</strong></p>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>Enrollment: 380 participants (95% of 400 target)</li>
                    <li>Live births: 1,640 (baseline: 1,640)</li>
                    <li>Infant deaths: 18 (baseline year: 25)</li>
                    <li>Baseline mortality rate: 15.2 per 1,000</li>
                </ul>
            </div>

            <div class="form-group">
                <label>Q13: What is the new infant mortality rate after intervention? (deaths / births) × 1,000</label>
                <input type="number" id="newMortalityRate" step="0.1" placeholder="Enter rate per 1,000 (e.g., 11.0)">
            </div>

            <div class="form-group">
                <label>Q14: What percentage reduction in mortality was achieved? [(baseline - new) / baseline] × 100</label>
                <input type="number" id="mortalityReduction" step="0.1" placeholder="Enter percentage (e.g., 27.6)">
            </div>

            <div class="form-group">
                <label>Q15: Did the program meet its 20% reduction goal?</label>
                <select id="goalMet">
                    <option value="">-- Select Answer --</option>
                    <option value="yes">Yes - exceeded the 20% target</option>
                    <option value="no">No - fell short of target</option>
                </select>
            </div>

            <div class="form-group">
                <label>Q16: If each infant death costs $400,000 (NICU, complications), what were cost savings? (prevented deaths × $400,000)</label>
                <input type="number" id="costSavings" placeholder="Enter savings (e.g., 2800000)">
            </div>

            <div class="form-group">
                <label>Q17: What is the ROI? [(savings - cost) / cost] × 100</label>
                <input type="number" id="programROI" step="0.1" placeholder="Enter ROI percentage (e.g., 636.8)">
            </div>

            <div class="form-group">
                <label>Q18: Evaluation Report - Summarize outcomes and scaling recommendations (150+ words)</label>
                <textarea id="evaluationReport" placeholder="Write: (1) Outcomes vs targets, (2) Most effective interventions, (3) Challenges/findings, (4) Improvement recommendations, (5) Scaling proposal"></textarea>
            </div>

            <button class="btn btn-secondary" onclick="showSection(3)">Back</button>
            <button class="btn btn-primary" onclick="calculateScore()">Complete & View Results</button>
        </div>

        <!-- Section 5: Results -->
        <div class="section" id="section5">
            <div class="section-header">
                <h2>Your Public Health Program Results</h2>
            </div>

            <div class="score-card">
                <h2 id="totalScore">--</h2>
                <p style="font-size: 1.2rem;">out of 100 points</p>
                <p id="scoreCategory" style="font-size: 1.3rem; font-weight: 600; margin-top: 15px;">--</p>
            </div>

            <div class="score-breakdown">
                <div class="score-item">
                    <h4>Section 1</h4>
                    <p>Needs Assessment</p>
                    <p id="score1" style="font-size: 1.5rem; font-weight: 600; color: var(--primary-green);">--/25</p>
                </div>
                <div class="score-item">
                    <h4>Section 2</h4>
                    <p>Program Design</p>
                    <p id="score2" style="font-size: 1.5rem; font-weight: 600; color: var(--primary-green);">--/20</p>
                </div>
                <div class="score-item">
                    <h4>Section 3</h4>
                    <p>Community Engagement</p>
                    <p id="score3" style="font-size: 1.5rem; font-weight: 600; color: var(--primary-green);">--/25</p>
                </div>
                <div class="score-item">
                    <h4>Section 4</h4>
                    <p>Evaluation</p>
                    <p id="score4" style="font-size: 1.5rem; font-weight: 600; color: var(--primary-green);">--/30</p>
                </div>
            </div>

            <div id="detailedFeedback"></div>

            <button class="btn btn-secondary" onclick="downloadReport()">Download Report</button>
            <button class="btn btn-primary" onclick="location.reload()">Start Over</button>
        </div>
    </div>

    <script>
        // Initialize Supabase
        let supabaseClient;
        let userEmail = null;

        function initSupabase() {
            if (typeof window.supabase === 'undefined') {
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
                script.onload = () => {
                    supabaseClient = window.supabase.createClient(
                        'https://clhuplhaejneecbyhphh.supabase.co',
                        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsaHVwbGhhZWpuZWVjYnlocGhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzU1MzM2MjgsImV4cCI6MjA1MTEwOTYyOH0.vyodBXNgvIrv3Bqhm32mG5qW9Sj_NnYUuD-9xOKtKho'
                    );
                };
                document.head.appendChild(script);
            } else {
                supabaseClient = window.supabase.createClient(
                    'https://clhuplhaejneecbyhphh.supabase.co',
                    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsaHVwbGhhZWpuZWVjYnlocGhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzU1MzM2MjgsImV4cCI6MjA1MTEwOTYyOH0.vyodBXNgvIrv3Bqhm32mG5qW9Sj_NnYUuD-9xOKtKho'
                );
            }

            const urlParams = new URLSearchParams(window.location.search);
            userEmail = urlParams.get('email') || localStorage.getItem('cloverpath_user_email');
        }

        // Global onclick handler functions
        window.toggleMaterials = function() {
            console.log('toggleMaterials called');
            const content = document.getElementById('materialsContent');
            const toggle = document.getElementById('materialsToggle');
            
            if (content && toggle) {
                if (content.classList.contains('open')) {
                    content.classList.remove('open');
                    toggle.textContent = '+';
                } else {
                    content.classList.add('open');
                    toggle.textContent = '−';
                }
            }
        }

        window.showSection = function(sectionNum) {
            console.log('showSection called:', sectionNum);
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.classList.remove('active'));
            
            const targetSection = document.getElementById('section' + sectionNum);
            if (targetSection) {
                targetSection.classList.add('active');
            }

            const progress = (sectionNum / 5) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressPercent').textContent = Math.round(progress) + '% Complete';

            const labels = ['Introduction', 'Needs Assessment', 'Program Design', 'Community Engagement', 'Evaluation', 'Results'];
            document.getElementById('progressLabel').textContent = labels[sectionNum];

            window.scrollTo({ top: 0, behavior: 'smooth' });

            try {
                window.parent.postMessage({ type: 'scroll-to-top' }, '*');
            } catch (e) {}

            setTimeout(window.sendHeightToParent, 100);
        }

        window.calculateScore = function() {
            console.log('calculateScore called');
            let s1 = 0, s2 = 0, s3 = 0, s4 = 0;

            // Get responses
            const totalDeaths = parseInt(document.getElementById('totalDeaths').value) || 0;
            const deathPct = parseFloat(document.getElementById('deathPercentage').value) || 0;
            const prevCause = document.getElementById('preventableCause').value;
            const needs = document.getElementById('needsAssessment').value;

            const intCost = parseInt(document.getElementById('interventionCost').value) || 0;
            const intensive = document.getElementById('intensiveService').value;
            const staffing = document.getElementById('staffingApproach').value;
            const design = document.getElementById('programDesign').value;

            const trust = document.getElementById('trustPartner').value;
            const outreach = document.getElementById('outreachStrategy').value;
            const doula = document.getElementById('doulaIntegration').value;
            const engage = document.getElementById('engagementStrategy').value;

            const newRate = parseFloat(document.getElementById('newMortalityRate').value) || 0;
            const reduction = parseFloat(document.getElementById('mortalityReduction').value) || 0;
            const goal = document.getElementById('goalMet').value;
            const savings = parseInt(document.getElementById('costSavings').value) || 0;
            const roi = parseFloat(document.getElementById('programROI').value) || 0;
            const report = document.getElementById('evaluationReport').value;

            let fb = '';

            // Section 1 (25 pts)
            fb += '<div class="feedback-box success"><h3>Section 1: Needs Assessment</h3>';
            
            if (totalDeaths === 25) {
                s1 += 6;
                fb += '<p><strong>CORRECT (6/6):</strong> 9+10+6 = 25 deaths in high-risk zips.</p>';
            } else {
                fb += '<p><strong>INCORRECT (0/6):</strong> 9+10+6 = 25 total deaths.</p>';
            }

            if (deathPct >= 71 && deathPct <= 72) {
                s1 += 6;
                fb += '<p><strong>CORRECT (6/6):</strong> (25/35)×100 = 71.4%.</p>';
            } else if (deathPct >= 65 && deathPct <= 75) {
                s1 += 3;
                fb += '<p><strong>WARNING (3/6):</strong> Close. (25/35)×100 = 71.4%.</p>';
            } else {
                fb += '<p><strong>INCORRECT (0/6):</strong> (25/35)×100 = 71.4%.</p>';
            }

            if (prevCause === 'sleep') {
                s1 += 5;
                fb += '<p><strong>CORRECT (5/5):</strong> Sleep deaths = 28% AND high preventability.</p>';
            } else if (prevCause === 'prematurity') {
                s1 += 2;
                fb += '<p><strong>WARNING (2/5):</strong> Prematurity most prevalent but only moderate preventability.</p>';
            } else {
                fb += '<p><strong>INCORRECT (0/5):</strong> Sleep deaths (28%, high preventability).</p>';
            }

            const nw = needs.trim().split(/\s+/).length;
            let ns = 0;
            if (nw >= 150) ns += 2; else if (nw >= 100) ns += 1;
            if (needs.toLowerCase().includes('10801') || needs.toLowerCase().includes('10802')) ns += 2;
            if (needs.toLowerCase().includes('sleep') || needs.toLowerCase().includes('premat')) ns += 2;
            if (needs.toLowerCase().includes('transport') || needs.toLowerCase().includes('language')) ns += 1;
            if (needs.toLowerCase().includes('hispanic') || needs.toLowerCase().includes('spanish')) ns += 1;
            s1 += Math.min(8, ns);
            fb += '<p><strong>Needs Assessment (' + Math.min(8,ns).toFixed(1) + '/8):</strong> ' + 
                  (ns >= 6 ? 'Strong analysis.' : 'Include: zip codes, causes, barriers, demographics.') + '</p>';
            
            fb += '</div>';

            // Section 2 (20 pts)
            fb += '<div class="feedback-box success"><h3>Section 2: Program Design</h3>';
            
            if (intCost === 146000) {
                s2 += 5;
                fb += '<p><strong>CORRECT (5/5):</strong> (80+240+45)×400 = $146,000.</p>';
            } else if (intCost >= 140000 && intCost <= 150000) {
                s2 += 2;
                fb += '<p><strong>WARNING (2/5):</strong> Close. (365)×400 = $146,000.</p>';
            } else {
                fb += '<p><strong>INCORRECT (0/5):</strong> (80+240+45)×400 = $146,000.</p>';
            }

            if (intensive === 'centering') {
                s2 += 5;
                fb += '<p><strong>CORRECT (5/5):</strong> Centering: $950, 33% reduction = best cost-effectiveness.</p>';
            } else if (intensive === 'home') {
                s2 += 2;
                fb += '<p><strong>WARNING (2/5):</strong> Home visiting works but $1,200 vs Centering $950 with better results.</p>';
            } else {
                fb += '<p><strong>INCORRECT (0/5):</strong> Centering Pregnancy: $950, 33% reduction.</p>';
            }

            if (staffing === 'chw') {
                s2 += 3;
                fb += '<p><strong>CORRECT (3/3):</strong> CHWs from neighborhoods = language + trust + lived experience.</p>';
            } else if (staffing === 'bilingual') {
                s2 += 1;
                fb += '<p><strong>WARNING (1/3):</strong> Bilingual helps but CHWs provide deeper cultural competency.</p>';
            } else {
                fb += '<p><strong>INCORRECT (0/3):</strong> Community Health Workers from target neighborhoods.</p>';
            }

            const dw = design.trim().split(/\s+/).length;
            let ds = 0;
            if (dw >= 150) ds += 2; else if (dw >= 100) ds += 1;
            if (design.toLowerCase().includes('safe sleep') || design.toLowerCase().includes('breastfeed')) ds += 1.5;
            if (design.toLowerCase().includes('spanish') || design.toLowerCase().includes('cultur')) ds += 1.5;
            if (design.toLowerCase().includes('immigr') || design.toLowerCase().includes('undocument')) ds += 1;
            if (design.toLowerCase().includes('transport') || design.toLowerCase().includes('schedul')) ds += 1;
            s2 += Math.min(7, ds);
            fb += '<p><strong>Design (' + Math.min(7,ds).toFixed(1) + '/7):</strong> ' +
                  (ds >= 5 ? 'Comprehensive program.' : 'Include: interventions, Spanish services, immigration, access.') + '</p>';
            
            fb += '</div>';

            // Section 3 (25 pts)
            fb += '<div class="feedback-box success"><h3>Section 3: Community Engagement</h3>';
            
            if (trust === 'familia') {
                s3 += 6;
                fb += '<p><strong>CORRECT (6/6):</strong> La Familia = community-based, non-governmental, trusted.</p>';
            } else {
                fb += '<p><strong>INCORRECT (0/6):</strong> La Familia Resource Center = non-governmental, trusted.</p>';
            }

            if (outreach === 'faith') {
                s3 += 6;
                fb += '<p><strong>CORRECT (6/6):</strong> Faith leaders = trusted messengers, 3,200+ weekly reach.</p>';
            } else if (outreach === 'clinic') {
                s3 += 2;
                fb += '<p><strong>WARNING (2/6):</strong> Clinics miss some. Faith leaders have broader trust.</p>';
            } else {
                fb += '<p><strong>INCORRECT (0/6):</strong> Faith-based outreach with leader endorsement.</p>';
            }

            if (doula === 'peer') {
                s3 += 5;
                fb += '<p><strong>CORRECT (5/5):</strong> Peer educators = ongoing support + cultural competency.</p>';
            } else if (doula === 'contract') {
                s3 += 2;
                fb += '<p><strong>WARNING (2/5):</strong> Fee-per-birth works but peer role gives ongoing support.</p>';
            } else {
                fb += '<p><strong>INCORRECT (0/5):</strong> Train as peer educators for continuous support.</p>';
            }

            const ew = engage.trim().split(/\s+/).length;
            let es = 0;
            if (ew >= 150) es += 2; else if (ew >= 100) es += 1;
            if (engage.toLowerCase().includes('immigr') || engage.toLowerCase().includes('fear')) es += 1.5;
            if (engage.toLowerCase().includes('familia') || engage.toLowerCase().includes('faith')) es += 1.5;
            if (engage.toLowerCase().includes('peer') || engage.toLowerCase().includes('testimon')) es += 1.5;
            if (engage.toLowerCase().includes('messag') || engage.toLowerCase().includes('language')) es += 1;
            if (engage.toLowerCase().includes('sustain') || engage.toLowerCase().includes('long-term')) es += 0.5;
            s3 += Math.min(8, es);
            fb += '<p><strong>Engagement (' + Math.min(8,es).toFixed(1) + '/8):</strong> ' +
                  (es >= 6 ? 'Strong trust-building.' : 'Address: immigration, partnerships, peers, messaging, sustainability.') + '</p>';
            
            fb += '</div>';

            // Section 4 (30 pts)
            fb += '<div class="feedback-box success"><h3>Section 4: Evaluation</h3>';
            
            if (newRate >= 10.9 && newRate <= 11.1) {
                s4 += 7;
                fb += '<p><strong>CORRECT (7/7):</strong> (18/1640)×1000 = 11.0.</p>';
            } else if (newRate >= 10 && newRate <= 12) {
                s4 += 3;
                fb += '<p><strong>WARNING (3/7):</strong> Close. (18/1640)×1000 = 11.0.</p>';
            } else {
                fb += '<p><strong>INCORRECT (0/7):</strong> (18/1640)×1000 = 11.0.</p>';
            }

            if (reduction >= 27.5 && reduction <= 28.5) {
                s4 += 7;
                fb += '<p><strong>CORRECT (7/7):</strong> [(15.2-11.0)/15.2]×100 = 27.6%.</p>';
            } else if (reduction >= 25 && reduction <= 30) {
                s4 += 3;
                fb += '<p><strong>WARNING (3/7):</strong> Close. [(15.2-11.0)/15.2]×100 = 27.6%.</p>';
            } else {
                fb += '<p><strong>INCORRECT (0/7):</strong> [(15.2-11.0)/15.2]×100 = 27.6%.</p>';
            }

            if (goal === 'yes') {
                s4 += 3;
                fb += '<p><strong>CORRECT (3/3):</strong> 27.6% exceeded 20% target!</p>';
            } else {
                fb += '<p><strong>INCORRECT (0/3):</strong> 27.6% exceeded 20% goal.</p>';
            }

            if (savings === 2800000) {
                s4 += 5;
                fb += '<p><strong>CORRECT (5/5):</strong> 7 deaths prevented × $400K = $2.8M.</p>';
            } else if (savings >= 2500000 && savings <= 3000000) {
                s4 += 2;
                fb += '<p><strong>WARNING (2/5):</strong> Close. (25-18)×$400K = $2.8M.</p>';
            } else {
                fb += '<p><strong>INCORRECT (0/5):</strong> 7×$400,000 = $2,800,000.</p>';
            }

            if (roi >= 636 && roi <= 638) {
                s4 += 5;
                fb += '<p><strong>CORRECT (5/5):</strong> [($2.8M-$380K)/$380K]×100 = 636.8%.</p>';
            } else if (roi >= 600 && roi <= 700) {
                s4 += 2;
                fb += '<p><strong>WARNING (2/5):</strong> Close. [(savings-cost)/cost]×100 = 636.8%.</p>';
            } else {
                fb += '<p><strong>INCORRECT (0/5):</strong> [($2.8M-$380K)/$380K]×100 = 636.8%.</p>';
            }

            const rw = report.trim().split(/\s+/).length;
            let rs = 0;
            if (rw >= 150) rs += 1;
            if (report.toLowerCase().includes('mortalit') || report.toLowerCase().includes('reduc')) rs += 0.75;
            if (report.toLowerCase().includes('safe sleep') || report.toLowerCase().includes('effective')) rs += 0.75;
            if (report.toLowerCase().includes('challenge') || report.toLowerCase().includes('barrier')) rs += 0.25;
            if (report.toLowerCase().includes('scal') || report.toLowerCase().includes('expand')) rs += 0.25;
            s4 += Math.min(3, rs);
            fb += '<p><strong>Report (' + Math.min(3,rs).toFixed(1) + '/3):</strong> ' +
                  (rs >= 2.5 ? 'Comprehensive summary.' : 'Include: outcomes, effectiveness, challenges, scaling.') + '</p>';
            
            fb += '</div>';

            const total = s1 + s2 + s3 + s4;

            document.getElementById('score1').textContent = s1.toFixed(1) + '/25';
            document.getElementById('score2').textContent = s2.toFixed(1) + '/20';
            document.getElementById('score3').textContent = s3.toFixed(1) + '/25';
            document.getElementById('score4').textContent = s4.toFixed(1) + '/30';
            document.getElementById('totalScore').textContent = total.toFixed(0);

            let cat = '';
            if (total >= 90) cat = 'Outstanding - Public Health Leadership Ready';
            else if (total >= 80) cat = 'Strong - Solid Community Health Skills';
            else if (total >= 70) cat = 'Good - Competent Program Design';
            else if (total >= 60) cat = 'Adequate - Basic Knowledge';
            else cat = 'Needs Improvement - Review Materials';

            document.getElementById('scoreCategory').textContent = cat;
            document.getElementById('detailedFeedback').innerHTML = fb;

            if (userEmail) {
                saveResults(total, s1, s2, s3, s4);
            }

            window.showSection(5);
        }

        async function saveResults(total, s1, s2, s3, s4) {
            try {
                await supabaseClient.from('simulation_results').upsert({
                    user_email: userEmail,
                    simulation_type: 'public_health',
                    total_score: Math.round(total),
                    section_scores: {
                        needs_assessment: s1,
                        program_design: s2,
                        community_engagement: s3,
                        evaluation: s4
                    },
                    completed_at: new Date().toISOString()
                }, { onConflict: 'user_email,simulation_type' });
            } catch (error) {
                console.error('Error saving:', error);
            }
        }

        window.downloadReport = function() {
            const content = `
PUBLIC HEALTH SIMULATION - RESULTS REPORT
Metro Health Department - Healthy Beginnings Initiative
Generated: ${new Date().toLocaleDateString()}

TOTAL SCORE: ${document.getElementById('totalScore').textContent}/100

SCORE BREAKDOWN:
- Section 1: Needs Assessment: ${document.getElementById('score1').textContent}
- Section 2: Program Design: ${document.getElementById('score2').textContent}
- Section 3: Community Engagement: ${document.getElementById('score3').textContent}
- Section 4: Evaluation: ${document.getElementById('score4').textContent}

PERFORMANCE: ${document.getElementById('scoreCategory').textContent}

YOUR RESPONSES:
${document.getElementById('detailedFeedback').innerText}
            `;

            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Public_Health_Simulation_Report.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        window.sendHeightToParent = function() {
            try {
                const height = document.body.scrollHeight + 100;
                window.parent.postMessage({ type: 'iframe-height', height: height }, '*');
            } catch (e) {}
        }

        document.addEventListener('DOMContentLoaded', function() {
            initSupabase();
        });

        window.addEventListener('load', function() {
            setTimeout(window.sendHeightToParent, 500);
            setTimeout(window.sendHeightToParent, 1500);
        });
    </script>
    
    <div id="content-end-marker" style="height: 1px;"></div>
</body>
</html>
